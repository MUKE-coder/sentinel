<!DOCTYPE html><!--5Swj18oapgqGqSZX8fol6--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/a68d47cca58670f5.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/a339dcc3b98340b3.js"/><script src="/_next/static/chunks/bfffc7ec77d3b06a.js" async=""></script><script src="/_next/static/chunks/b9cfbaaba1fd82be.js" async=""></script><script src="/_next/static/chunks/c540f39c8777f86f.js" async=""></script><script src="/_next/static/chunks/turbopack-a8b0537048952335.js" async=""></script><script src="/_next/static/chunks/4cc5a908347f559b.js" async=""></script><script src="/_next/static/chunks/26ca110782d86623.js" async=""></script><script src="/_next/static/chunks/81f0f13d25d49d65.js" async=""></script><script src="/_next/static/chunks/c23263069b7f7ba3.js" async=""></script><script src="/_next/static/chunks/2425b678dfc0c3cf.js" async=""></script><title>Anomaly Detection - Sentinel Docs</title><meta name="description" content="Production-grade security middleware for Go/Gin applications. WAF, rate limiting, threat detection, AI analysis, and an embedded dashboard."/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><nav class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-950/80 backdrop-blur-xl"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center gap-8"><a class="flex items-center gap-2.5 group" href="/"><div class="w-8 h-8 rounded-lg bg-gradient-to-br from-sentinel-400 to-sentinel-600 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield text-white"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path></svg></div><span class="font-bold text-lg tracking-tight">Sentinel</span></a><div class="hidden md:flex items-center gap-6"><a class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors flex items-center gap-1.5" href="/docs/getting-started"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg>Docs</a><a class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors" href="/docs/api-reference">API</a></div></div><div class="flex items-center gap-3"><div class="hidden sm:block"><button class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm text-gray-500 dark:text-gray-400 w-64"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="flex-1 text-left">Search docs...</span><kbd class="hidden sm:flex items-center gap-0.5 text-[10px] font-mono text-gray-400 dark:text-gray-500 bg-gray-200 dark:bg-gray-800 px-1.5 py-0.5 rounded"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-command"><path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3"></path></svg> K</kbd></button></div><div class="w-9 h-9"></div><a href="https://github.com/MUKE-coder/sentinel" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github text-gray-600 dark:text-gray-400"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><button class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></nav><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><button class="lg:hidden mb-4 p-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><div class="flex gap-10"><aside class="hidden lg:block w-64 flex-shrink-0"><div class="sticky top-20 overflow-y-auto max-h-[calc(100vh-5rem)] pb-10 pr-4"><nav class="space-y-6"><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Getting Started</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/getting-started">Introduction</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/configuration">Configuration</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Security</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/waf">WAF</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/rate-limiting">Rate Limiting</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/auth-shield">Auth Shield</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/security-headers">Security Headers</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Intelligence</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/threat-intelligence">Threat Intelligence</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors bg-sentinel-50 dark:bg-sentinel-950/50 text-sentinel-600 dark:text-sentinel-400 font-medium" href="/docs/anomaly-detection">Anomaly Detection</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/security-score">Security Score</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Monitoring</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/the-dashboard">Dashboard</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/performance">Performance</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/alerting">Alerting</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Data</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/audit-logging">Audit Logging</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/ai-analysis">AI Analysis</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/compliance-reports">Compliance Reports</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Reference</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/api-reference">API Reference</a></li></ul></div></nav></div></aside><main class="min-w-0 flex-1 prose-docs"><h1>Anomaly Detection</h1><p>Sentinel includes a statistical anomaly detection system that identifies unusual traffic patterns by comparing real-time user activity against learned behavioral baselines. Unlike the WAF, which matches known attack signatures, anomaly detection catches previously unseen threats by flagging activity that deviates from what is normal for each user.</p><p>The detector builds per-user baselines from historical activity data — typical active hours, frequently accessed routes, source IPs, geographic locations, and request velocity. When new activity diverges significantly from these baselines, Sentinel emits a threat event with type<!-- --> <code>AnomalyDetected</code>.</p><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Requires a UserExtractor</p><div class="text-sm text-gray-700 dark:text-gray-300">Anomaly detection operates on a per-user basis. You must configure a<!-- --> <code>UserExtractor</code> in your Sentinel config so the system can associate requests with user identities. Without it, the anomaly detector has no user context and will not run.</div></div></div></div><h2 id="configuration">Configuration</h2><p>Anomaly detection is disabled by default. Enable it by setting <code>Enabled: true</code> in your <code>AnomalyConfig</code>. The minimal configuration uses all defaults:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">main.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    sentinel </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/gin-gonic/gin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    r </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Mount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain">        Anomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">            Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">            Sensitivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalySensitivityMedium</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain">        UserExtractor</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserContext </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain">                ID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-ID&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain">                Email</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-Email&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">22</span><span class="token plain">                Role</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">  c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-Role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">23</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">24</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">25</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">26</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">27</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GET</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/data&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">28</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">200</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;status&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;ok&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">29</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">30</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">31</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">32</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h3>AnomalyConfig Reference</h3><table><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>Enabled</code></td><td><code>bool</code></td><td><code>false</code></td><td>Enables anomaly detection. When false, the detector is a no-op.</td></tr><tr><td><code>Sensitivity</code></td><td><code>AnomalySensitivity</code></td><td><code>AnomalySensitivityMedium</code></td><td>Controls the scoring threshold that triggers an anomaly event. See sensitivity levels below.</td></tr><tr><td><code>LearningPeriod</code></td><td><code>time.Duration</code></td><td><code>7 * 24 * time.Hour</code></td><td>How far back to look when computing a user&#x27;s behavioral baseline. Longer periods produce more stable baselines but are slower to adapt.</td></tr><tr><td><code>Checks</code></td><td><code>[]AnomalyCheckType</code></td><td>All checks enabled</td><td>Which anomaly checks to run. If empty, all check types are enabled. Specify a subset to narrow detection scope.</td></tr></tbody></table><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">config.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token plain">Anomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">    Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    Sensitivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalySensitivityMedium</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">14</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 2 weeks of history</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">    Checks</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyCheckType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">        sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckOffHoursAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">        sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckUnusualAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain">        sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckVelocityAnomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">        sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckImpossibleTravel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain">        sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckDataExfiltration</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h2 id="sensitivity">Sensitivity Levels</h2><p>Sensitivity controls the anomaly score threshold required to emit a threat event. Each anomaly check contributes a score, and the total is compared against the threshold. Lower thresholds trigger more alerts.</p><table><thead><tr><th>Level</th><th>Constant</th><th>Threshold</th><th>Behavior</th></tr></thead><tbody><tr><td>Low</td><td><code>sentinel.AnomalySensitivityLow</code></td><td>50</td><td>Only the most significant anomalies trigger events. Fewer alerts, less noise. Best for high-traffic applications where some deviation is normal.</td></tr><tr><td>Medium</td><td><code>sentinel.AnomalySensitivityMedium</code></td><td>30</td><td>Balanced detection. Catches meaningful deviations without overwhelming you with alerts. Recommended starting point.</td></tr><tr><td>High</td><td><code>sentinel.AnomalySensitivityHigh</code></td><td>15</td><td>Aggressive detection. Catches subtle anomalies but produces more alerts. Best for high-security environments or during active incident investigation.</td></tr></tbody></table><div class="my-4 rounded-lg border p-4 bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check-big mt-0.5 flex-shrink-0 text-green-500"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg><div><p class="font-semibold text-sm mb-1 text-green-800 dark:text-green-300">Recommended Starting Point</p><div class="text-sm text-gray-700 dark:text-gray-300">Start with <code>AnomalySensitivityMedium</code>. Monitor the anomaly events in the dashboard for a week to understand your application&#x27;s normal patterns, then adjust up or down based on the signal-to-noise ratio you observe.</div></div></div></div><h2 id="checks">What Gets Detected</h2><p>The anomaly detector runs a configurable set of behavioral checks against each user activity event. Each check compares one aspect of the current request against the user&#x27;s baseline and returns a score from 0 (normal) to 30 (highly anomalous). Scores from all checks are summed (capped at 100) and compared against the sensitivity threshold.</p><table><thead><tr><th>Check</th><th>Constant</th><th>Max Score</th><th>What It Detects</th></tr></thead><tbody><tr><td>Off-Hours Access</td><td><code>CheckOffHoursAccess</code></td><td>30</td><td>Activity during hours when the user is rarely active. If the current hour represents less than 1% of baseline activity, the full score is assigned; less than 3% yields a partial score of 15.</td></tr><tr><td>Unusual Route Access</td><td><code>CheckUnusualAccess</code></td><td>25</td><td>Access to routes (method + path) that the user has never accessed before during the learning period. Useful for detecting lateral movement or account compromise.</td></tr><tr><td>Velocity Anomaly</td><td><code>CheckVelocityAnomaly</code></td><td>25</td><td>Request rate spikes that exceed 3x the user&#x27;s average rate for the current time of day. Catches automated scraping, credential stuffing, or bot activity on a compromised account.</td></tr><tr><td>Impossible Travel</td><td><code>CheckImpossibleTravel</code></td><td>30</td><td>Activity from a new IP address, especially from a country the user has never connected from. A new country yields a score of 30; a new IP in the same country yields 10.</td></tr><tr><td>Data Exfiltration</td><td><code>CheckDataExfiltration</code></td><td>20</td><td>Unusually large response sizes or durations that exceed 5x the user&#x27;s baseline average. Indicates potential bulk data extraction.</td></tr><tr><td>Credential Stuffing</td><td><code>CheckCredentialStuffing</code></td><td>--</td><td>Reserved check type for detecting credential stuffing patterns. Configure via Auth Shield for full brute-force protection.</td></tr></tbody></table><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Enable only specific checks</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">Checks</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyCheckType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckOffHoursAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckImpossibleTravel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Omit checks that are not relevant to your application</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><div class="my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300">Minimum Baseline Requirement</p><div class="text-sm text-gray-700 dark:text-gray-300">The anomaly detector requires at least <strong>10 historical activity records</strong> for a user before it will evaluate checks. Users with fewer records are silently skipped. This prevents false positives on new users or accounts with very little history.</div></div></div></div><h2 id="how-it-works">How It Works</h2><p>The anomaly detector operates as a handler in Sentinel&#x27;s asynchronous event pipeline. It does not sit in the HTTP request path and adds no latency to your responses.</p><ol><li><strong>Activity Tracking</strong> — When a request arrives, Sentinel records a<!-- --> <code>UserActivity</code> event containing the user ID, timestamp, IP address, HTTP method, path, response duration, and geographic country (if geo is enabled).</li><li><strong>Pipeline Dispatch</strong> — The activity event is sent to the async pipeline via a non-blocking ring buffer. This decouples detection from request handling.</li><li><strong>Baseline Computation</strong> — The detector loads the user&#x27;s historical activity from storage (within the configured <code>LearningPeriod</code>) and computes a<!-- --> <code>UserBaseline</code>. Baselines are cached for 1 hour to avoid repeated computation.</li><li><strong>Check Evaluation</strong> — Each enabled check compares the current activity against the baseline and returns a score. Scores are summed and capped at 100.</li><li><strong>Threshold Comparison</strong> — If the total score meets or exceeds the sensitivity threshold, a <code>ThreatEvent</code> is emitted with type<!-- --> <code>AnomalyDetected</code>.</li><li><strong>Event Processing</strong> — The threat event flows through the rest of the pipeline: it is persisted to storage, updates the threat actor profile, recalculates the security score, and triggers alerts if the severity meets the alerting threshold.</li></ol><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token plain"># Anomaly detection flow:</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#</span></div><div class="token-line" style="color:#403f53"><span class="token plain"># HTTP Request ──&gt; Record UserActivity ──&gt; Async Pipeline</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#       │                                       │</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#       v                                       v</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#   Response sent                    Load/Compute Baseline</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#   (no added latency)                          │</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                               v</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                    Run Checks (score each)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                               │</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                    ┌──────────┴──────────┐</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                    v                      v</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                              Score &lt; Threshold      Score &gt;= Threshold</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                    │                      │</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                    v                      v</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                No action           Emit ThreatEvent</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                                          │</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                                          v</span></div><div class="token-line" style="color:#403f53"><span class="token plain">#                                                  Persist + Alert</span></div></pre></div></div><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Non-Blocking Detection</p><div class="text-sm text-gray-700 dark:text-gray-300">The anomaly detector runs entirely outside the HTTP request path. Activity recording uses a non-blocking ring buffer, so detection never slows down your API responses, even when computing baselines from large activity histories.</div></div></div></div><h2 id="baselines">Baselines</h2><p>A <code>UserBaseline</code> captures the behavioral profile for a single user. It is computed from all activity within the <code>LearningPeriod</code> and cached in memory for 1 hour before being recomputed.</p><table><thead><tr><th>Baseline Field</th><th>What It Tracks</th><th>Used By</th></tr></thead><tbody><tr><td><code>ActiveHours</code></td><td>Distribution of activity across hours of the day (0-23)</td><td><code>CheckOffHoursAccess</code></td></tr><tr><td><code>TypicalRoutes</code></td><td>Set of method+path combinations the user has accessed</td><td><code>CheckUnusualAccess</code></td></tr><tr><td><code>AvgRequestsPerHour</code></td><td>Average request rate across the learning period</td><td><code>CheckVelocityAnomaly</code></td></tr><tr><td><code>SourceIPs</code></td><td>Set of IP addresses the user has connected from</td><td><code>CheckImpossibleTravel</code></td></tr><tr><td><code>Countries</code></td><td>Set of countries (by geo lookup) the user has connected from</td><td><code>CheckImpossibleTravel</code></td></tr><tr><td><code>AvgResponseSize</code></td><td>Average response duration/size across the learning period</td><td><code>CheckDataExfiltration</code></td></tr></tbody></table><p>The <code>LearningPeriod</code> determines the time window for baseline computation. The default is 7 days. A longer period (e.g., 14 or 30 days) produces more stable baselines but adapts more slowly to legitimate changes in user behavior.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Short learning period — adapts quickly, less stable</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 3 days</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Default — balanced</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 7 days</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Long learning period — very stable, slow to adapt</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">30</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 30 days</span></div></pre></div></div><h2 id="events">Anomaly Events</h2><p>When an anomaly is detected, Sentinel emits a <code>ThreatEvent</code> with the threat type<!-- --> <code>AnomalyDetected</code>. These events appear in the dashboard alongside WAF detections and other security events.</p><table><thead><tr><th>Event Field</th><th>Value</th></tr></thead><tbody><tr><td><code>ThreatTypes</code></td><td><code>[&quot;AnomalyDetected&quot;]</code></td></tr><tr><td><code>Severity</code></td><td>Computed from the anomaly score: Critical (≥80), High (≥60), Medium (≥30), Low (&lt;30)</td></tr><tr><td><code>Confidence</code></td><td>The raw anomaly score (0-100), representing how far the activity deviates from baseline</td></tr><tr><td><code>Evidence</code></td><td>Contains the anomaly score and the list of checks that contributed to it</td></tr><tr><td><code>Blocked</code></td><td><code>false</code> — anomaly events are informational; they do not block requests</td></tr></tbody></table><h3>Severity Mapping</h3><p>The anomaly score is mapped to a severity level using the following thresholds:</p><table><thead><tr><th>Score Range</th><th>Severity</th><th>Interpretation</th></tr></thead><tbody><tr><td>80 - 100</td><td><code>Critical</code></td><td>Multiple strong anomaly signals. Very likely a compromised account or active attack.</td></tr><tr><td>60 - 79</td><td><code>High</code></td><td>Significant deviation from baseline. Warrants immediate investigation.</td></tr><tr><td>30 - 59</td><td><code>Medium</code></td><td>Moderate deviation. Could be a legitimate change in behavior or early sign of compromise.</td></tr><tr><td>0 - 29</td><td><code>Low</code></td><td>Minor deviation. Usually benign but logged for audit purposes.</td></tr></tbody></table><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Anomaly Events Are Non-Blocking</p><div class="text-sm text-gray-700 dark:text-gray-300">Anomaly events are always informational — they never block requests. The detector flags suspicious behavior so you can investigate, but it does not interrupt user sessions. To automatically respond to anomalies, pair anomaly detection with the<!-- --> <a href="/docs/alerting">alerting system</a> to receive notifications when high-severity anomalies occur.</div></div></div></div><h2 id="full-example">Full Configuration Example</h2><p>Below is a complete example that enables anomaly detection alongside other Sentinel features:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">main.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    sentinel </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/gin-gonic/gin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    r </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Mount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Enable anomaly detection</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">        Anomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">            Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">            Sensitivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalySensitivityMedium</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain">            LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain">            Checks</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyCheckType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain">                sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckOffHoursAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain">                sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckUnusualAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">22</span><span class="token plain">                sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckVelocityAnomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">23</span><span class="token plain">                sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckImpossibleTravel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">24</span><span class="token plain">                sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckDataExfiltration</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">25</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">26</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">27</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">28</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Required: tell Sentinel how to identify users</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">29</span><span class="token plain">        UserExtractor</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserContext </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">30</span><span class="token plain">            userID </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-ID&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">31</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> userID </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">32</span><span class="token plain">                </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Unauthenticated request</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">33</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">34</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">35</span><span class="token plain">                ID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    userID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">36</span><span class="token plain">                Email</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-Email&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">37</span><span class="token plain">                Role</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">  c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-User-Role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">38</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">39</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">40</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">41</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Enable geo for country-based anomaly checks</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">42</span><span class="token plain">        Geo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">GeoConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">43</span><span class="token plain">            Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">44</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">45</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">46</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Alert on high-severity anomalies</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">47</span><span class="token plain">        Alerts</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AlertConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">48</span><span class="token plain">            MinSeverity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">SeverityHigh</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">49</span><span class="token plain">            Webhook</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">WebhookConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">50</span><span class="token plain">                URL</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;https://hooks.example.com/sentinel&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">51</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">52</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">53</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">54</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">55</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GET</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/data&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">56</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">200</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;status&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;ok&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">57</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">58</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">59</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">60</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h2 id="testing">Testing Considerations</h2><p>Anomaly detection requires sufficient historical data to produce meaningful baselines. This makes it harder to test than the WAF or rate limiter, which respond immediately. Here are strategies for testing effectively.</p><h3>Building a Baseline</h3><p>The detector requires at least 10 activity records for a user before it will evaluate checks. In a test environment, you can seed activity data by sending authenticated requests over a consistent pattern, then introducing an anomalous request to verify detection.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token plain"># Seed baseline activity (repeat over multiple hours/days for a realistic baseline)</span></div><div class="token-line" style="color:#403f53"><span class="token plain">for i in $(seq 1 20); do</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    curl -s -H &quot;X-User-ID: testuser&quot; http://localhost:8080/api/data &gt; /dev/null</span></div><div class="token-line" style="color:#403f53"><span class="token plain">    sleep 1</span></div><div class="token-line" style="color:#403f53"><span class="token plain">done</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain"># Now trigger an anomaly — access from a different IP or unusual route</span></div><div class="token-line" style="color:#403f53"><span class="token plain">curl -s -H &quot;X-User-ID: testuser&quot; http://localhost:8080/admin/settings</span></div><div class="token-line" style="color:#403f53"><span class="token plain"># Check the Sentinel dashboard for an AnomalyDetected event</span></div></pre></div></div><h3>Shorter Learning Period for Tests</h3><p>Use a short <code>LearningPeriod</code> in test environments so baselines are computed from a smaller window of data:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// In tests, use a short learning period</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">Anomaly</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    Sensitivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalySensitivityHigh</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Catch everything</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">                  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Short window for tests</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h3>Unit Testing</h3><p>You can test the anomaly detector programmatically by creating a store, seeding activity data, and calling <code>CheckActivity</code> directly:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">anomaly_test.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">TestAnomalyDetection</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">t </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">T</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">    store </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> memory</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    store</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Migrate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Background</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">    pipe </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1000</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">defer</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Stop</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">    geo </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> intelligence</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">NewGeoLocator</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">GeoConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain">Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    detector </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> intelligence</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">NewAnomalyDetector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> geo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain">        Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain">        LearningPeriod</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain">        Sensitivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalySensitivityMedium</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">        Checks</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AnomalyCheckType</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">            sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckOffHoursAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">            sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckUnusualAccess</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain">            sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">CheckImpossibleTravel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">22</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Seed baseline: weekday 9-5 activity from US IP</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">23</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> day </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> day </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> day</span><span class="token operator" style="color:rgb(12, 150, 155)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">24</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">for</span><span class="token plain"> hour </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> hour </span><span class="token operator" style="color:rgb(12, 150, 155)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">17</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> hour</span><span class="token operator" style="color:rgb(12, 150, 155)">++</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">25</span><span class="token plain">            ts </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Now</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Add</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token plain">time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Duration</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">day</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">24</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">26</span><span class="token plain">            store</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">SaveUserActivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserActivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">27</span><span class="token plain">                ID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        fmt</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Sprintf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;act-%d-%d&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> day</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">28</span><span class="token plain">                Timestamp</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Date</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Year</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ts</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Month</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ts</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Day</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> hour</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ts</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Location</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">29</span><span class="token plain">                UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">30</span><span class="token plain">                Path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">      </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/data&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">31</span><span class="token plain">                Method</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;GET&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">32</span><span class="token plain">                IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">33</span><span class="token plain">                Country</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">   </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;US&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">34</span><span class="token plain">            </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">35</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">36</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">37</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">38</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Trigger anomaly: 3am access from a new country</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">39</span><span class="token plain">    err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> detector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">CheckActivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserActivity</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">40</span><span class="token plain">        UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">41</span><span class="token plain">        Timestamp</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Date</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">2025</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">15</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">3</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UTC</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">42</span><span class="token plain">        Path</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">      </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/admin/settings&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">43</span><span class="token plain">        Method</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;GET&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">44</span><span class="token plain">        IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;203.0.113.1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">45</span><span class="token plain">        Country</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">   </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;RU&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">46</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">47</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">48</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Fatal</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">49</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">50</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">51</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Verify a ThreatEvent was emitted via the pipeline</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">52</span><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Sleep</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Millisecond</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">53</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Check pipeline or store for AnomalyDetected event</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">54</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><div class="my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300">Timing in Tests</p><div class="text-sm text-gray-700 dark:text-gray-300">The anomaly detector emits threat events asynchronously through the pipeline. In unit tests, add a short <code>time.Sleep</code> (e.g., 100ms) after calling <code>CheckActivity</code> <!-- -->to allow the pipeline to process the event before asserting on results.</div></div></div></div><h2>Next Steps</h2><ul><li><a href="/docs/configuration">Configuration Reference</a> — Full AnomalyConfig field reference</li><li><a href="/docs/auth-shield">Auth Shield</a> — Brute-force and credential stuffing protection</li><li><a href="/docs/waf">WAF</a> — Signature-based attack detection to complement anomaly detection</li><li><a href="/docs/alerting">Alerting</a> — Get notified when anomalies are detected</li><li><a href="/docs/the-dashboard">Dashboard</a> — View anomaly events and user baselines</li></ul><!--$--><!--/$--></main></div></div><script src="/_next/static/chunks/a339dcc3b98340b3.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[82031,[\"/_next/static/chunks/4cc5a908347f559b.js\"],\"ThemeProvider\"]\n3:I[95401,[\"/_next/static/chunks/4cc5a908347f559b.js\"],\"default\"]\n4:I[45121,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n5:I[60512,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n6:I[99113,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"ClientSegmentRoot\"]\n7:I[45693,[\"/_next/static/chunks/4cc5a908347f559b.js\",\"/_next/static/chunks/c23263069b7f7ba3.js\"],\"default\"]\n3e:I[50025,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n:HL[\"/_next/static/chunks/a68d47cca58670f5.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"5Swj18oapgqGqSZX8fol6\",\"c\":[\"\",\"docs\",\"anomaly-detection\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[\"anomaly-detection\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/a68d47cca58670f5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/4cc5a908347f559b.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"min-h-screen antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/c23263069b7f7ba3.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"Component\":\"$7\",\"slots\":{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"serverProvidedParams\":{\"params\":{},\"promises\":[\"$@8\"]}}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h1\",null,{\"children\":\"Anomaly Detection\"}],[\"$\",\"p\",null,{\"children\":\"Sentinel includes a statistical anomaly detection system that identifies unusual traffic patterns by comparing real-time user activity against learned behavioral baselines. Unlike the WAF, which matches known attack signatures, anomaly detection catches previously unseen threats by flagging activity that deviates from what is normal for each user.\"}],[\"$\",\"p\",null,{\"children\":[\"The detector builds per-user baselines from historical activity data — typical active hours, frequently accessed routes, source IPs, geographic locations, and request velocity. When new activity diverges significantly from these baselines, Sentinel emits a threat event with type\",\" \",[\"$\",\"code\",null,{\"children\":\"AnomalyDetected\"}],\".\"]}],[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Requires a UserExtractor\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"Anomaly detection operates on a per-user basis. You must configure a\",\" \",\"$L9\",\" in your Sentinel config so the system can associate requests with user identities. Without it, the anomaly detector has no user context and will not run.\"]}]]}]]}]}],\"$La\",\"$Lb\",\"$Lc\",\"$Ld\",\"$Le\",\"$Lf\",\"$L10\",\"$L11\",\"$L12\",\"$L13\",\"$L14\",\"$L15\",\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\",\"$L1b\",\"$L1c\",\"$L1d\",\"$L1e\",\"$L1f\",\"$L20\",\"$L21\",\"$L22\",\"$L23\",\"$L24\",\"$L25\",\"$L26\",\"$L27\",\"$L28\",\"$L29\",\"$L2a\",\"$L2b\",\"$L2c\",\"$L2d\",\"$L2e\",\"$L2f\",\"$L30\",\"$L31\",\"$L32\",\"$L33\",\"$L34\",\"$L35\",\"$L36\",\"$L37\",\"$L38\",\"$L39\",\"$L3a\"],[\"$L3b\"],\"$L3c\"]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$L3d\",false]],\"m\":\"$undefined\",\"G\":[\"$3e\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"3f:I[99151,[\"/_next/static/chunks/4cc5a908347f559b.js\",\"/_next/static/chunks/c23263069b7f7ba3.js\",\"/_next/static/chunks/2425b678dfc0c3cf.js\"],\"default\"]\n43:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"OutletBoundary\"]\n44:\"$Sreact.suspense\"\n46:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"ViewportBoundary\"]\n48:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"MetadataBoundary\"]\n9:[\"$\",\"code\",null,{\"children\":\"UserExtractor\"}]\na:[\"$\",\"h2\",null,{\"id\":\"configuration\",\"children\":\"Configuration\"}]\nb:[\"$\",\"p\",null,{\"children\":[\"Anomaly detection is disabled by default. Enable it by setting \",[\"$\",\"code\",null,{\"children\":\"Enabled: true\"}],\" in your \",[\"$\",\"code\",null,{\"children\":\"AnomalyConfig\"}],\". The minimal configuration uses all defaults:\"]}]\nc:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"filename\":\"main.go\",\"code\":\"package main\\n\\nimport (\\n    \\\"time\\\"\\n\\n    sentinel \\\"github.com/MUKE-coder/sentinel\\\"\\n    \\\"github.com/gin-gonic/gin\\\"\\n)\\n\\nfunc main() {\\n    r := gin.Default()\\n\\n    sentinel.Mount(r, nil, sentinel.Config{\\n        Anomaly: sentinel.AnomalyConfig{\\n            Enabled:    true,\\n            Sensitivity: sentinel.AnomalySensitivityMedium,\\n        },\\n        UserExtractor: func(c *gin.Context) *sentinel.UserContext {\\n            return \u0026sentinel.UserContext{\\n                ID:    c.GetHeader(\\\"X-User-ID\\\"),\\n                Email: c.GetHeader(\\\"X-User-Email\\\"),\\n                Role:  c.GetHeader(\\\"X-User-Role\\\"),\\n            }\\n        },\\n    })\\n\\n    r.GET(\\\"/api/data\\\", func(c *gin.Context) {\\n        c.JSON(200, gin.H{\\\"status\\\": \\\"ok\\\"})\\n    })\\n\\n    r.Run(\\\":8080\\\")\\n}\"}]\nd:[\"$\",\"h3\",null,{\"children\":\"AnomalyConfig Reference\"}]\n"])</script><script>self.__next_f.push([1,"e:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Field\"}],[\"$\",\"th\",null,{\"children\":\"Type\"}],[\"$\",\"th\",null,{\"children\":\"Default\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Enabled\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bool\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"false\"}]}],[\"$\",\"td\",null,{\"children\":\"Enables anomaly detection. When false, the detector is a no-op.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Sensitivity\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AnomalySensitivity\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AnomalySensitivityMedium\"}]}],[\"$\",\"td\",null,{\"children\":\"Controls the scoring threshold that triggers an anomaly event. See sensitivity levels below.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"LearningPeriod\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"time.Duration\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"7 * 24 * time.Hour\"}]}],[\"$\",\"td\",null,{\"children\":\"How far back to look when computing a user's behavioral baseline. Longer periods produce more stable baselines but are slower to adapt.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Checks\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"[]AnomalyCheckType\"}]}],[\"$\",\"td\",null,{\"children\":\"All checks enabled\"}],[\"$\",\"td\",null,{\"children\":\"Which anomaly checks to run. If empty, all check types are enabled. Specify a subset to narrow detection scope.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"f:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"filename\":\"config.go\",\"code\":\"Anomaly: sentinel.AnomalyConfig{\\n    Enabled:        true,\\n    Sensitivity:    sentinel.AnomalySensitivityMedium,\\n    LearningPeriod: 14 * 24 * time.Hour, // 2 weeks of history\\n    Checks: []sentinel.AnomalyCheckType{\\n        sentinel.CheckOffHoursAccess,\\n        sentinel.CheckUnusualAccess,\\n        sentinel.CheckVelocityAnomaly,\\n        sentinel.CheckImpossibleTravel,\\n        sentinel.CheckDataExfiltration,\\n    },\\n}\"}]\n10:[\"$\",\"h2\",null,{\"id\":\"sensitivity\",\"children\":\"Sensitivity Levels\"}]\n11:[\"$\",\"p\",null,{\"children\":\"Sensitivity controls the anomaly score threshold required to emit a threat event. Each anomaly check contributes a score, and the total is compared against the threshold. Lower thresholds trigger more alerts.\"}]\n"])</script><script>self.__next_f.push([1,"12:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Level\"}],[\"$\",\"th\",null,{\"children\":\"Constant\"}],[\"$\",\"th\",null,{\"children\":\"Threshold\"}],[\"$\",\"th\",null,{\"children\":\"Behavior\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Low\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"sentinel.AnomalySensitivityLow\"}]}],[\"$\",\"td\",null,{\"children\":\"50\"}],[\"$\",\"td\",null,{\"children\":\"Only the most significant anomalies trigger events. Fewer alerts, less noise. Best for high-traffic applications where some deviation is normal.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Medium\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"sentinel.AnomalySensitivityMedium\"}]}],[\"$\",\"td\",null,{\"children\":\"30\"}],[\"$\",\"td\",null,{\"children\":\"Balanced detection. Catches meaningful deviations without overwhelming you with alerts. Recommended starting point.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"High\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"sentinel.AnomalySensitivityHigh\"}]}],[\"$\",\"td\",null,{\"children\":\"15\"}],[\"$\",\"td\",null,{\"children\":\"Aggressive detection. Catches subtle anomalies but produces more alerts. Best for high-security environments or during active incident investigation.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"13:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-circle-check-big mt-0.5 flex-shrink-0 text-green-500\",\"children\":[[\"$\",\"path\",\"yps3ct\",{\"d\":\"M21.801 10A10 10 0 1 1 17 3.335\"}],[\"$\",\"path\",\"1pflzl\",{\"d\":\"m9 11 3 3L22 4\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-green-800 dark:text-green-300\",\"children\":\"Recommended Starting Point\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"Start with \",[\"$\",\"code\",null,{\"children\":\"AnomalySensitivityMedium\"}],\". Monitor the anomaly events in the dashboard for a week to understand your application's normal patterns, then adjust up or down based on the signal-to-noise ratio you observe.\"]}]]}]]}]}]\n14:[\"$\",\"h2\",null,{\"id\":\"checks\",\"children\":\"What Gets Detected\"}]\n15:[\"$\",\"p\",null,{\"children\":\"The anomaly detector runs a configurable set of behavioral checks against each user activity event. Each check compares one aspect of the current request against the user's baseline and returns a score from 0 (normal) to 30 (highly anomalous). Scores from all checks are summed (capped at 100) and compared against the sensitivity threshold.\"}]\n"])</script><script>self.__next_f.push([1,"16:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Check\"}],[\"$\",\"th\",null,{\"children\":\"Constant\"}],[\"$\",\"th\",null,{\"children\":\"Max Score\"}],[\"$\",\"th\",null,{\"children\":\"What It Detects\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Off-Hours Access\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckOffHoursAccess\"}]}],[\"$\",\"td\",null,{\"children\":\"30\"}],[\"$\",\"td\",null,{\"children\":\"Activity during hours when the user is rarely active. If the current hour represents less than 1% of baseline activity, the full score is assigned; less than 3% yields a partial score of 15.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Unusual Route Access\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckUnusualAccess\"}]}],[\"$\",\"td\",null,{\"children\":\"25\"}],[\"$\",\"td\",null,{\"children\":\"Access to routes (method + path) that the user has never accessed before during the learning period. Useful for detecting lateral movement or account compromise.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Velocity Anomaly\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckVelocityAnomaly\"}]}],[\"$\",\"td\",null,{\"children\":\"25\"}],[\"$\",\"td\",null,{\"children\":\"Request rate spikes that exceed 3x the user's average rate for the current time of day. Catches automated scraping, credential stuffing, or bot activity on a compromised account.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Impossible Travel\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckImpossibleTravel\"}]}],[\"$\",\"td\",null,{\"children\":\"30\"}],[\"$\",\"td\",null,{\"children\":\"Activity from a new IP address, especially from a country the user has never connected from. A new country yields a score of 30; a new IP in the same country yields 10.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Data Exfiltration\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckDataExfiltration\"}]}],[\"$\",\"td\",null,{\"children\":\"20\"}],[\"$\",\"td\",null,{\"children\":\"Unusually large response sizes or durations that exceed 5x the user's baseline average. Indicates potential bulk data extraction.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"Credential Stuffing\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckCredentialStuffing\"}]}],[\"$\",\"td\",null,{\"children\":\"--\"}],[\"$\",\"td\",null,{\"children\":\"Reserved check type for detecting credential stuffing patterns. Configure via Auth Shield for full brute-force protection.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"17:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"showLineNumbers\":false,\"code\":\"// Enable only specific checks\\nChecks: []sentinel.AnomalyCheckType{\\n    sentinel.CheckOffHoursAccess,\\n    sentinel.CheckImpossibleTravel,\\n    // Omit checks that are not relevant to your application\\n}\"}]\n18:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500\",\"children\":[[\"$\",\"path\",\"wmoenq\",{\"d\":\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\"}],[\"$\",\"path\",\"juzpu7\",{\"d\":\"M12 9v4\"}],[\"$\",\"path\",\"p32p05\",{\"d\":\"M12 17h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300\",\"children\":\"Minimum Baseline Requirement\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"The anomaly detector requires at least \",[\"$\",\"strong\",null,{\"children\":\"10 historical activity records\"}],\" for a user before it will evaluate checks. Users with fewer records are silently skipped. This prevents false positives on new users or accounts with very little history.\"]}]]}]]}]}]\n19:[\"$\",\"h2\",null,{\"id\":\"how-it-works\",\"children\":\"How It Works\"}]\n1a:[\"$\",\"p\",null,{\"children\":\"The anomaly detector operates as a handler in Sentinel's asynchronous event pipeline. It does not sit in the HTTP request path and adds no latency to your responses.\"}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"ol\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Activity Tracking\"}],\" — When a request arrives, Sentinel records a\",\" \",[\"$\",\"code\",null,{\"children\":\"UserActivity\"}],\" event containing the user ID, timestamp, IP address, HTTP method, path, response duration, and geographic country (if geo is enabled).\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Pipeline Dispatch\"}],\" — The activity event is sent to the async pipeline via a non-blocking ring buffer. This decouples detection from request handling.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Baseline Computation\"}],\" — The detector loads the user's historical activity from storage (within the configured \",[\"$\",\"code\",null,{\"children\":\"LearningPeriod\"}],\") and computes a\",\" \",[\"$\",\"code\",null,{\"children\":\"UserBaseline\"}],\". Baselines are cached for 1 hour to avoid repeated computation.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Check Evaluation\"}],\" — Each enabled check compares the current activity against the baseline and returns a score. Scores are summed and capped at 100.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Threshold Comparison\"}],\" — If the total score meets or exceeds the sensitivity threshold, a \",[\"$\",\"code\",null,{\"children\":\"ThreatEvent\"}],\" is emitted with type\",\" \",[\"$\",\"code\",null,{\"children\":\"AnomalyDetected\"}],\".\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Event Processing\"}],\" — The threat event flows through the rest of the pipeline: it is persisted to storage, updates the threat actor profile, recalculates the security score, and triggers alerts if the severity meets the alerting threshold.\"]}]]}]\n"])</script><script>self.__next_f.push([1,"40:T44e,# Anomaly detection flow:\n#\n# HTTP Request ──\u003e Record UserActivity ──\u003e Async Pipeline\n#       │                                       │\n#       v                                       v\n#   Response sent                    Load/Compute Baseline\n#   (no added latency)                          │\n#                                               v\n#                                    Run Checks (score each)\n#                                               │\n#                                    ┌──────────┴──────────┐\n#                                    v                      v\n#                              Score \u003c Threshold      Score \u003e= Threshold\n#                                    │                      │\n#                                    v                      v\n#                                No action           Emit ThreatEvent\n#                                                          │\n#                                                          v\n#                                                  Persist + Alert1c:[\"$\",\"$L3f\",null,{\"language\":\"bash\",\"showLineNumbers\":false,\"code\":\"$40\"}]\n1d:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Non-Blocking Detection\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":\"The anomaly detector runs entirely outside the HTTP request path. Activity recording uses a non-blocking ring buffer, so detection never slows down your API responses, even when computing baselines from large activity histories.\"}]]}]]}]}]\n1e:[\"$\",\"h2\",null,{\"id\":\"baselines\",\"children\":\"Baselines\"}]\n1f:[\"$\",\"p\",null,{\"children\":[\"A \",[\"$\",\"code\",null,{\"children\":\"UserBaseline\"}],\" captures the behavioral profile for a single user. It is computed from all activity within the \",[\"$\",\"code\",null,{\"children\":\"LearningPeriod\"}],\" and cached in memory for 1 hour before being recomputed.\"]}]\n"])</script><script>self.__next_f.push([1,"20:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Baseline Field\"}],[\"$\",\"th\",null,{\"children\":\"What It Tracks\"}],[\"$\",\"th\",null,{\"children\":\"Used By\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ActiveHours\"}]}],[\"$\",\"td\",null,{\"children\":\"Distribution of activity across hours of the day (0-23)\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckOffHoursAccess\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"TypicalRoutes\"}]}],[\"$\",\"td\",null,{\"children\":\"Set of method+path combinations the user has accessed\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckUnusualAccess\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AvgRequestsPerHour\"}]}],[\"$\",\"td\",null,{\"children\":\"Average request rate across the learning period\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckVelocityAnomaly\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SourceIPs\"}]}],[\"$\",\"td\",null,{\"children\":\"Set of IP addresses the user has connected from\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckImpossibleTravel\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Countries\"}]}],[\"$\",\"td\",null,{\"children\":\"Set of countries (by geo lookup) the user has connected from\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckImpossibleTravel\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AvgResponseSize\"}]}],[\"$\",\"td\",null,{\"children\":\"Average response duration/size across the learning period\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CheckDataExfiltration\"}]}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"21:[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"children\":\"LearningPeriod\"}],\" determines the time window for baseline computation. The default is 7 days. A longer period (e.g., 14 or 30 days) produces more stable baselines but adapts more slowly to legitimate changes in user behavior.\"]}]\n22:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"showLineNumbers\":false,\"code\":\"// Short learning period — adapts quickly, less stable\\nLearningPeriod: 3 * 24 * time.Hour,  // 3 days\\n\\n// Default — balanced\\nLearningPeriod: 7 * 24 * time.Hour,  // 7 days\\n\\n// Long learning period — very stable, slow to adapt\\nLearningPeriod: 30 * 24 * time.Hour, // 30 days\"}]\n23:[\"$\",\"h2\",null,{\"id\":\"events\",\"children\":\"Anomaly Events\"}]\n24:[\"$\",\"p\",null,{\"children\":[\"When an anomaly is detected, Sentinel emits a \",[\"$\",\"code\",null,{\"children\":\"ThreatEvent\"}],\" with the threat type\",\" \",[\"$\",\"code\",null,{\"children\":\"AnomalyDetected\"}],\". These events appear in the dashboard alongside WAF detections and other security events.\"]}]\n25:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Event Field\"}],[\"$\",\"th\",null,{\"children\":\"Value\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ThreatTypes\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"[\\\"AnomalyDetected\\\"]\"}]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Severity\"}]}],[\"$\",\"td\",null,{\"children\":\"Computed from the anomaly score: Critical (≥80), High (≥60), Medium (≥30), Low (\u003c30)\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Confidence\"}]}],[\"$\",\"td\",null,{\"children\":\"The raw anomaly score (0-100), representing how far the activity deviates from baseline\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Evidence\"}]}],[\"$\",\"td\",null,{\"children\":\"Contains the anomaly score and the list of checks that contributed to it\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Blocked\"}]}],[\"$\",\"td\",null,{\"children\":[[\"$\",\"code\",null,{\"children\":\"false\"}],\" — anomaly events are informational; they do not block requests\"]}]]}]]}]]}]\n26:[\"$\",\"h3\",null,{\"children\":\"Severity Mapping\"}]\n27:[\"$\",\"p\",null,{\"children\":\"The anomaly score is mapped to a severity level using the following thresholds:\"}]\n28:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Score Range\"}],[\"$\",\"th\",null,{\"children\":\"Severity\"}],[\"$\",\"th\",null,{\"children\":\"Interpretation\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"80 - 100\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Critical\"}]}],[\"$\",\"td\",null,{\"children\":\"Multiple strong anomaly signals. Very likely a compromised account or active attack.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"60 - 79\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"High\"}]}],[\"$\",\"td\",null,{\"children\":\"Significant deviation from baseline. Warrants immediate investigation.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"30 - 59\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Medium\"}]}],[\"$\",\"td\",null,{\"children\":\"Moderate deviation. Could be a legitimate change in behavior or early sign of compromise.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":\"0 - 29\"}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Low\"}]}],[\"$\",\"td\",null,{\"children\":\"Minor deviation. Usually benign but logged for audit purposes.\"}]]}]]}]]}]\n29:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeW"])</script><script>self.__next_f.push([1,"idth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Anomaly Events Are Non-Blocking\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"Anomaly events are always informational — they never block requests. The detector flags suspicious behavior so you can investigate, but it does not interrupt user sessions. To automatically respond to anomalies, pair anomaly detection with the\",\" \",[\"$\",\"a\",null,{\"href\":\"/docs/alerting\",\"children\":\"alerting system\"}],\" to receive notifications when high-severity anomalies occur.\"]}]]}]]}]}]\n2a:[\"$\",\"h2\",null,{\"id\":\"full-example\",\"children\":\"Full Configuration Example\"}]\n2b:[\"$\",\"p\",null,{\"children\":\"Below is a complete example that enables anomaly detection alongside other Sentinel features:\"}]\n41:T6b2,"])</script><script>self.__next_f.push([1,"package main\n\nimport (\n    \"time\"\n\n    sentinel \"github.com/MUKE-coder/sentinel\"\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    r := gin.Default()\n\n    sentinel.Mount(r, nil, sentinel.Config{\n        // Enable anomaly detection\n        Anomaly: sentinel.AnomalyConfig{\n            Enabled:        true,\n            Sensitivity:    sentinel.AnomalySensitivityMedium,\n            LearningPeriod: 7 * 24 * time.Hour,\n            Checks: []sentinel.AnomalyCheckType{\n                sentinel.CheckOffHoursAccess,\n                sentinel.CheckUnusualAccess,\n                sentinel.CheckVelocityAnomaly,\n                sentinel.CheckImpossibleTravel,\n                sentinel.CheckDataExfiltration,\n            },\n        },\n\n        // Required: tell Sentinel how to identify users\n        UserExtractor: func(c *gin.Context) *sentinel.UserContext {\n            userID := c.GetHeader(\"X-User-ID\")\n            if userID == \"\" {\n                return nil // Unauthenticated request\n            }\n            return \u0026sentinel.UserContext{\n                ID:    userID,\n                Email: c.GetHeader(\"X-User-Email\"),\n                Role:  c.GetHeader(\"X-User-Role\"),\n            }\n        },\n\n        // Enable geo for country-based anomaly checks\n        Geo: sentinel.GeoConfig{\n            Enabled: true,\n        },\n\n        // Alert on high-severity anomalies\n        Alerts: sentinel.AlertConfig{\n            MinSeverity: sentinel.SeverityHigh,\n            Webhook: \u0026sentinel.WebhookConfig{\n                URL: \"https://hooks.example.com/sentinel\",\n            },\n        },\n    })\n\n    r.GET(\"/api/data\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\"status\": \"ok\"})\n    })\n\n    r.Run(\":8080\")\n}"])</script><script>self.__next_f.push([1,"2c:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"filename\":\"main.go\",\"code\":\"$41\"}]\n2d:[\"$\",\"h2\",null,{\"id\":\"testing\",\"children\":\"Testing Considerations\"}]\n2e:[\"$\",\"p\",null,{\"children\":\"Anomaly detection requires sufficient historical data to produce meaningful baselines. This makes it harder to test than the WAF or rate limiter, which respond immediately. Here are strategies for testing effectively.\"}]\n2f:[\"$\",\"h3\",null,{\"children\":\"Building a Baseline\"}]\n30:[\"$\",\"p\",null,{\"children\":\"The detector requires at least 10 activity records for a user before it will evaluate checks. In a test environment, you can seed activity data by sending authenticated requests over a consistent pattern, then introducing an anomalous request to verify detection.\"}]\n31:[\"$\",\"$L3f\",null,{\"language\":\"bash\",\"showLineNumbers\":false,\"code\":\"# Seed baseline activity (repeat over multiple hours/days for a realistic baseline)\\nfor i in $(seq 1 20); do\\n    curl -s -H \\\"X-User-ID: testuser\\\" http://localhost:8080/api/data \u003e /dev/null\\n    sleep 1\\ndone\\n\\n# Now trigger an anomaly — access from a different IP or unusual route\\ncurl -s -H \\\"X-User-ID: testuser\\\" http://localhost:8080/admin/settings\\n# Check the Sentinel dashboard for an AnomalyDetected event\"}]\n32:[\"$\",\"h3\",null,{\"children\":\"Shorter Learning Period for Tests\"}]\n33:[\"$\",\"p\",null,{\"children\":[\"Use a short \",[\"$\",\"code\",null,{\"children\":\"LearningPeriod\"}],\" in test environments so baselines are computed from a smaller window of data:\"]}]\n34:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"showLineNumbers\":false,\"code\":\"// In tests, use a short learning period\\nAnomaly: sentinel.AnomalyConfig{\\n    Enabled:        true,\\n    Sensitivity:    sentinel.AnomalySensitivityHigh, // Catch everything\\n    LearningPeriod: 1 * time.Hour,                  // Short window for tests\\n}\"}]\n35:[\"$\",\"h3\",null,{\"children\":\"Unit Testing\"}]\n36:[\"$\",\"p\",null,{\"children\":[\"You can test the anomaly detector programmatically by creating a store, seeding activity data, and calling \",[\"$\",\"code\",null,{\"children\":\"CheckActivity\"}],\" directly:\"]}]\n42:T744,"])</script><script>self.__next_f.push([1,"func TestAnomalyDetection(t *testing.T) {\n    store := memory.New()\n    store.Migrate(context.Background())\n\n    pipe := pipeline.New(1000)\n    pipe.Start(1)\n    defer pipe.Stop()\n\n    geo := intelligence.NewGeoLocator(sentinel.GeoConfig{Enabled: false})\n\n    detector := intelligence.NewAnomalyDetector(store, pipe, geo, sentinel.AnomalyConfig{\n        Enabled:        true,\n        LearningPeriod: 7 * 24 * time.Hour,\n        Sensitivity:    sentinel.AnomalySensitivityMedium,\n        Checks: []sentinel.AnomalyCheckType{\n            sentinel.CheckOffHoursAccess,\n            sentinel.CheckUnusualAccess,\n            sentinel.CheckImpossibleTravel,\n        },\n    })\n\n    // Seed baseline: weekday 9-5 activity from US IP\n    for day := 1; day \u003c= 7; day++ {\n        for hour := 9; hour \u003c= 17; hour++ {\n            ts := time.Now().Add(-time.Duration(day) * 24 * time.Hour)\n            store.SaveUserActivity(ctx, \u0026sentinel.UserActivity{\n                ID:        fmt.Sprintf(\"act-%d-%d\", day, hour),\n                Timestamp: time.Date(ts.Year(), ts.Month(), ts.Day(), hour, 0, 0, 0, ts.Location()),\n                UserID:    \"user1\",\n                Path:      \"/api/data\",\n                Method:    \"GET\",\n                IP:        \"10.0.0.1\",\n                Country:   \"US\",\n            })\n        }\n    }\n\n    // Trigger anomaly: 3am access from a new country\n    err := detector.CheckActivity(ctx, \u0026sentinel.UserActivity{\n        UserID:    \"user1\",\n        Timestamp: time.Date(2025, 1, 15, 3, 0, 0, 0, time.UTC),\n        Path:      \"/admin/settings\",\n        Method:    \"GET\",\n        IP:        \"203.0.113.1\",\n        Country:   \"RU\",\n    })\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    // Verify a ThreatEvent was emitted via the pipeline\n    time.Sleep(100 * time.Millisecond)\n    // Check pipeline or store for AnomalyDetected event\n}"])</script><script>self.__next_f.push([1,"37:[\"$\",\"$L3f\",null,{\"language\":\"go\",\"filename\":\"anomaly_test.go\",\"code\":\"$42\"}]\n38:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500\",\"children\":[[\"$\",\"path\",\"wmoenq\",{\"d\":\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\"}],[\"$\",\"path\",\"juzpu7\",{\"d\":\"M12 9v4\"}],[\"$\",\"path\",\"p32p05\",{\"d\":\"M12 17h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300\",\"children\":\"Timing in Tests\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"The anomaly detector emits threat events asynchronously through the pipeline. In unit tests, add a short \",[\"$\",\"code\",null,{\"children\":\"time.Sleep\"}],\" (e.g., 100ms) after calling \",[\"$\",\"code\",null,{\"children\":\"CheckActivity\"}],\" \",\"to allow the pipeline to process the event before asserting on results.\"]}]]}]]}]}]\n39:[\"$\",\"h2\",null,{\"children\":\"Next Steps\"}]\n3a:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/configuration\",\"children\":\"Configuration Reference\"}],\" — Full AnomalyConfig field reference\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/auth-shield\",\"children\":\"Auth Shield\"}],\" — Brute-force and credential stuffing protection\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/waf\",\"children\":\"WAF\"}],\" — Signature-based attack detection to complement anomaly detection\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/alerting\",\"children\":\"Alerting\"}],\" — Get notified when anomalies are detected\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/the-dashboard\",\"children\":\"Dashboard\"}],\" — View anomaly events and user baselines\"]}]]}]\n3b:[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/2425b678dfc0c3cf.js\",\"async\":true,\"nonce\":\"$undefined\"}]\n3c:[\"$\",\"$L43\",null,{\"children\":[\"$\",\"$44\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@45\"}]}]\n3d:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L46\",null,{\"children\":\"$L47\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L48\",null,{\"children\":[\"$\",\"$44\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L49\"}]}]}],null]}]\n8:\"$0:f:0:1:1:children:0:props:children:1:props:serverProvidedParams:params\"\n"])</script><script>self.__next_f.push([1,"47:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"45:null\n49:[[\"$\",\"title\",\"0\",{\"children\":\"Anomaly Detection - Sentinel Docs\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Production-grade security middleware for Go/Gin applications. WAF, rate limiting, threat detection, AI analysis, and an embedded dashboard.\"}]]\n"])</script></body></html>