<!DOCTYPE html><!--5Swj18oapgqGqSZX8fol6--><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/chunks/a68d47cca58670f5.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/a339dcc3b98340b3.js"/><script src="/_next/static/chunks/bfffc7ec77d3b06a.js" async=""></script><script src="/_next/static/chunks/b9cfbaaba1fd82be.js" async=""></script><script src="/_next/static/chunks/c540f39c8777f86f.js" async=""></script><script src="/_next/static/chunks/turbopack-a8b0537048952335.js" async=""></script><script src="/_next/static/chunks/4cc5a908347f559b.js" async=""></script><script src="/_next/static/chunks/26ca110782d86623.js" async=""></script><script src="/_next/static/chunks/81f0f13d25d49d65.js" async=""></script><script src="/_next/static/chunks/c23263069b7f7ba3.js" async=""></script><script src="/_next/static/chunks/2425b678dfc0c3cf.js" async=""></script><title>Audit Logging - Sentinel Docs</title><meta name="description" content="Production-grade security middleware for Go/Gin applications. WAF, rate limiting, threat detection, AI analysis, and an embedded dashboard."/><script src="/_next/static/chunks/a6dad97d9634a72d.js" noModule=""></script></head><body class="min-h-screen antialiased"><div hidden=""><!--$--><!--/$--></div><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","system",null,["light","dark"],null,true,true)</script><nav class="sticky top-0 z-50 w-full border-b border-gray-200 dark:border-gray-800 bg-white/80 dark:bg-gray-950/80 backdrop-blur-xl"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex items-center justify-between h-16"><div class="flex items-center gap-8"><a class="flex items-center gap-2.5 group" href="/"><div class="w-8 h-8 rounded-lg bg-gradient-to-br from-sentinel-400 to-sentinel-600 flex items-center justify-center"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shield text-white"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path></svg></div><span class="font-bold text-lg tracking-tight">Sentinel</span></a><div class="hidden md:flex items-center gap-6"><a class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors flex items-center gap-1.5" href="/docs/getting-started"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-open"><path d="M12 7v14"></path><path d="M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z"></path></svg>Docs</a><a class="text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors" href="/docs/api-reference">API</a></div></div><div class="flex items-center gap-3"><div class="hidden sm:block"><button class="flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-sm text-gray-500 dark:text-gray-400 w-64"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg><span class="flex-1 text-left">Search docs...</span><kbd class="hidden sm:flex items-center gap-0.5 text-[10px] font-mono text-gray-400 dark:text-gray-500 bg-gray-200 dark:bg-gray-800 px-1.5 py-0.5 rounded"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-command"><path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3"></path></svg> K</kbd></button></div><div class="w-9 h-9"></div><a href="https://github.com/MUKE-coder/sentinel" target="_blank" rel="noopener noreferrer" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-github text-gray-600 dark:text-gray-400"><path d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4"></path><path d="M9 18c-4.51 2-5-2-7-2"></path></svg></a><button class="md:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button></div></div></div></nav><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><button class="lg:hidden mb-4 p-2 rounded-lg border border-gray-200 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><div class="flex gap-10"><aside class="hidden lg:block w-64 flex-shrink-0"><div class="sticky top-20 overflow-y-auto max-h-[calc(100vh-5rem)] pb-10 pr-4"><nav class="space-y-6"><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Getting Started</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/getting-started">Introduction</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/configuration">Configuration</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Security</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/waf">WAF</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/rate-limiting">Rate Limiting</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/auth-shield">Auth Shield</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/security-headers">Security Headers</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Intelligence</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/threat-intelligence">Threat Intelligence</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/anomaly-detection">Anomaly Detection</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/security-score">Security Score</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Monitoring</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/the-dashboard">Dashboard</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/performance">Performance</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/alerting">Alerting</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Data</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors bg-sentinel-50 dark:bg-sentinel-950/50 text-sentinel-600 dark:text-sentinel-400 font-medium" href="/docs/audit-logging">Audit Logging</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/ai-analysis">AI Analysis</a></li><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/compliance-reports">Compliance Reports</a></li></ul></div><div><h4 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-3">Reference</h4><ul class="space-y-0.5"><li><a class="block px-3 py-1.5 rounded-lg text-sm transition-colors text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-900" href="/docs/api-reference">API Reference</a></li></ul></div></nav></div></aside><main class="min-w-0 flex-1 prose-docs"><h1>Audit Logging</h1><p>Sentinel includes a GORM plugin that automatically tracks every database mutation — creates, updates, and deletes — and records them as immutable audit log entries. Every change captures <em>who</em> made it, <em>what</em> changed (including before/after state for updates), and <em>when</em> it happened. Audit entries flow through the Sentinel pipeline asynchronously, so your application code is never blocked by audit writes.</p><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Optional Package</p><div class="text-sm text-gray-700 dark:text-gray-300">The GORM audit logging plugin lives in a separate package (<code>github.com/MUKE-coder/sentinel/gorm</code>). It is completely optional — your core Sentinel middleware works independently. Import it only if your application uses GORM and you want automatic database-level audit trails.</div></div></div></div><h2 id="installation">Installation</h2><p>The audit logging plugin requires two Sentinel packages: the GORM plugin itself and the event pipeline that transports audit entries to storage.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">go imports</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">    sentinelgorm </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/gorm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/pipeline&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></pre></div></div><p>Make sure both packages are available in your module:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token plain">go get github.com/MUKE-coder/sentinel/gorm</span></div><div class="token-line" style="color:#403f53"><span class="token plain">go get github.com/MUKE-coder/sentinel/pipeline</span></div></pre></div></div><h2 id="setup">Setup</h2><p>Setting up audit logging takes three steps: create a pipeline, start its background workers, and register the plugin with your GORM database instance.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">main.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 1. Create an event pipeline with a buffer of 10,000 events</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">pipe </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 0 = DefaultBufferSize (10,000)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 2. Start background workers to process audit events</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 2 worker goroutines</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">defer</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Stop</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// 3. Register the Sentinel GORM plugin</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Use</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></pre></div></div><p>By default, <code>sentinelgorm.New(pipe)</code> enables both audit logging and query shielding (N+1 detection, unfiltered query warnings). You can selectively disable features using option functions:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Audit logging only — disable query shielding</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Use</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">QueryShieldEnabled </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Query shielding only — disable audit logging</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Use</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AuditEnabled </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">false</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span></div></pre></div></div><h3>Plugin Config</h3><table><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>AuditEnabled</code></td><td><code>bool</code></td><td><code>true</code></td><td>Enables audit logging for CREATE, UPDATE, and DELETE operations.</td></tr><tr><td><code>QueryShieldEnabled</code></td><td><code>bool</code></td><td><code>true</code></td><td>Enables query analysis (N+1 detection, unfiltered query warnings).</td></tr><tr><td><code>SlowQueryThreshold</code></td><td><code>time.Duration</code></td><td><code>200ms</code></td><td>Queries slower than this duration are flagged.</td></tr><tr><td><code>N1QueryThreshold</code></td><td><code>int</code></td><td><code>10</code></td><td>Number of same-table queries in a single request before flagging as N+1.</td></tr></tbody></table><h2 id="request-context">Request Context</h2><p>For audit entries to include <em>who</em> performed the action, you need to attach request metadata to the GORM context using <code>sentinelgorm.WithRequestInfo()</code>. This connects each database operation back to the originating HTTP request.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">handler.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">CreateProductHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Build request info from the current HTTP request</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    ctx </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithRequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">RequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">        IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ClientIP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">        UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// from your auth middleware</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">        UserEmail</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_email&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">        UserRole</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">  c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain">        UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">        RequestID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;request_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain">    product </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> Product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Widget&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> Price</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9.99</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Use db.WithContext(ctx) so the plugin picks up the request info</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">500</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">201</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><div class="my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"></path><path d="M12 9v4"></path><path d="M12 17h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300">Context is Required for Attribution</p><div class="text-sm text-gray-700 dark:text-gray-300">If you call <code>db.Create(&amp;record)</code> without attaching request info via<!-- --> <code>WithContext</code>, the audit entry is still created but the <code>UserID</code>,<!-- --> <code>IP</code>, and <code>UserAgent</code> fields will be empty. Always use<!-- --> <code>db.WithContext(ctx)</code> in your HTTP handlers for full attribution.</div></div></div></div><h3>RequestInfo Fields</h3><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>IP</code></td><td><code>string</code></td><td>Client IP address of the request originator.</td></tr><tr><td><code>UserID</code></td><td><code>string</code></td><td>Authenticated user identifier (from your auth middleware).</td></tr><tr><td><code>UserEmail</code></td><td><code>string</code></td><td>Email address of the authenticated user.</td></tr><tr><td><code>UserRole</code></td><td><code>string</code></td><td>Role of the authenticated user (e.g., <code>&quot;admin&quot;</code>, <code>&quot;editor&quot;</code>).</td></tr><tr><td><code>UserAgent</code></td><td><code>string</code></td><td>The User-Agent header from the HTTP request.</td></tr><tr><td><code>RequestID</code></td><td><code>string</code></td><td>Unique request identifier for correlating multiple audit entries from a single request.</td></tr></tbody></table><h2 id="what-gets-logged">What Gets Logged</h2><p>The plugin hooks into GORM callbacks for all mutation operations. Every CREATE, UPDATE, and DELETE that passes through GORM produces an audit entry. Read operations (SELECT) are not audited — they are handled separately by the query shield feature.</p><table><thead><tr><th>Operation</th><th>Action Value</th><th>Before State</th><th>After State</th><th>Description</th></tr></thead><tbody><tr><td><strong>Create</strong></td><td><code>CREATE</code></td><td>-</td><td>Full record</td><td>Captures the complete newly created record.</td></tr><tr><td><strong>Update</strong></td><td><code>UPDATE</code></td><td>Record before change</td><td>Record after change</td><td>Captures both the previous and new state so you can diff exactly what changed.</td></tr><tr><td><strong>Delete</strong></td><td><code>DELETE</code></td><td>Record before deletion</td><td>-</td><td>Captures the full record state before it was removed.</td></tr></tbody></table><p>Each audit entry also records:</p><ul><li><strong>Table name</strong> — which database table was affected (e.g., <code>users</code>, <code>products</code>)</li><li><strong>Record ID</strong> — the primary key of the affected record</li><li><strong>User attribution</strong> — UserID, UserEmail, UserRole from the request context</li><li><strong>Request metadata</strong> — IP address, User-Agent, RequestID</li><li><strong>Timestamp</strong> — when the operation occurred</li><li><strong>Success flag</strong> — whether the database operation succeeded</li></ul><div class="my-4 rounded-lg border p-4 bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check-big mt-0.5 flex-shrink-0 text-green-500"><path d="M21.801 10A10 10 0 1 1 17 3.335"></path><path d="m9 11 3 3L22 4"></path></svg><div><p class="font-semibold text-sm mb-1 text-green-800 dark:text-green-300">Before/After Diffing</p><div class="text-sm text-gray-700 dark:text-gray-300">For UPDATE operations, the plugin captures the model state before the update runs (in a<!-- --> <code>Before</code> callback) and after it completes. Both states are serialized as JSON, giving you a complete before/after snapshot that you can diff to see exactly which fields changed.</div></div></div></div><h2 id="audit-log-model">The AuditLog Model</h2><p>Every audit entry is represented by the <code>AuditLog</code> struct defined in the<!-- --> <code>core</code> package. This is the shape of the data that gets stored and returned by the API.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">core/models.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// AuditLog represents an immutable audit trail entry.</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> AuditLog </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain">    ID         </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    Timestamp  time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Time </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;timestamp&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">    UserID     </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;user_id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    UserEmail  </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;user_email,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    UserRole   </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;user_role,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain">    Action     </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;action&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">    Resource   </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;resource&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain">    ResourceID </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;resource_id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    Before     JSONMap   </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;before,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain">    After      JSONMap   </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;after,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain">    IP         </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;ip&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain">    UserAgent  </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;user_agent&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">    Success    </span><span class="token builtin" style="color:rgb(72, 118, 214)">bool</span><span class="token plain">      </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;success&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">    Error      </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;error,omitempty&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">    RequestID  </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;request_id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h3>Field Reference</h3><table><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>ID</code></td><td><code>string</code></td><td>UUID v4 unique identifier for the audit entry.</td></tr><tr><td><code>Timestamp</code></td><td><code>time.Time</code></td><td>When the database operation occurred.</td></tr><tr><td><code>UserID</code></td><td><code>string</code></td><td>ID of the user who performed the operation.</td></tr><tr><td><code>UserEmail</code></td><td><code>string</code></td><td>Email of the user (omitted if empty).</td></tr><tr><td><code>UserRole</code></td><td><code>string</code></td><td>Role of the user (omitted if empty).</td></tr><tr><td><code>Action</code></td><td><code>string</code></td><td>The operation type: <code>CREATE</code>, <code>UPDATE</code>, or <code>DELETE</code>.</td></tr><tr><td><code>Resource</code></td><td><code>string</code></td><td>The database table name (e.g., <code>users</code>, <code>orders</code>).</td></tr><tr><td><code>ResourceID</code></td><td><code>string</code></td><td>The primary key value of the affected record.</td></tr><tr><td><code>Before</code></td><td><code>JSONMap</code></td><td>JSON snapshot of the record before the change. Present for UPDATE and DELETE; omitted for CREATE.</td></tr><tr><td><code>After</code></td><td><code>JSONMap</code></td><td>JSON snapshot of the record after the change. Present for CREATE and UPDATE; omitted for DELETE.</td></tr><tr><td><code>IP</code></td><td><code>string</code></td><td>Client IP address from the request context.</td></tr><tr><td><code>UserAgent</code></td><td><code>string</code></td><td>User-Agent header from the request context.</td></tr><tr><td><code>Success</code></td><td><code>bool</code></td><td>Whether the database operation completed without error.</td></tr><tr><td><code>Error</code></td><td><code>string</code></td><td>Error message if the operation failed (omitted on success).</td></tr><tr><td><code>RequestID</code></td><td><code>string</code></td><td>Correlation ID to link multiple audit entries from a single HTTP request.</td></tr></tbody></table><h2 id="full-example">Full Example</h2><p>The following example shows a complete <code>main.go</code> that sets up Sentinel with the GORM audit logging plugin, creates an HTTP handler that attaches request context, and performs a database mutation that produces an audit trail entry.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">main.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">package</span><span class="token plain"> main</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;net/http&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    sentinel </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    sentinelgorm </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/gorm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/pipeline&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/gin-gonic/gin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gorm.io/driver/sqlite&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gorm.io/gorm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> Product </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain">    ID    </span><span class="token builtin" style="color:rgb(72, 118, 214)">uint</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`gorm:&quot;primaryKey&quot; json:&quot;id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain">    Name  </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;name&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">    Price </span><span class="token builtin" style="color:rgb(72, 118, 214)">float64</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;price&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">main</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// --- Database setup ---</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">22</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> gorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Open</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sqlite</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Open</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;app.db&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">gorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">23</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">24</span><span class="token plain">        </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">panic</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;failed to connect database&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">25</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">26</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">AutoMigrate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">Product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">27</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">28</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// --- Pipeline setup ---</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">29</span><span class="token plain">    pipe </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// default 10,000 buffer</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">30</span><span class="token plain">    pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">31</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">defer</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Stop</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">32</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">33</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// --- Register GORM audit plugin ---</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">34</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Use</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">35</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">36</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// --- Gin router ---</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">37</span><span class="token plain">    r </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Default</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">38</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">39</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Mount Sentinel middleware + dashboard</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">40</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Mount</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">41</span><span class="token plain">        WAF</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">WAFConfig</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">42</span><span class="token plain">            Enabled</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">43</span><span class="token plain">            Mode</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">ModeBlock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">44</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">45</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">47</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// --- Routes ---</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">48</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">POST</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/products&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">49</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Attach request info so audit entries include user attribution</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">50</span><span class="token plain">        ctx </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithRequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">RequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">51</span><span class="token plain">            IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ClientIP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">52</span><span class="token plain">            UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">53</span><span class="token plain">            UserEmail</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_email&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">54</span><span class="token plain">            UserRole</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">  c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_role&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">55</span><span class="token plain">            UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">56</span><span class="token plain">            RequestID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetHeader</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;X-Request-ID&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">57</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">58</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">59</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> product Product</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">60</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ShouldBindJSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">61</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusBadRequest</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">62</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">63</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">64</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">65</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// This Create() call automatically generates an audit log entry</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">66</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">67</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">68</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">69</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">70</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">71</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusCreated</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">72</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">73</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">74</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">PUT</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/products/:id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">75</span><span class="token plain">        ctx </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithRequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">RequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">76</span><span class="token plain">            IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ClientIP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">77</span><span class="token plain">            UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">78</span><span class="token plain">            UserEmail</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_email&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">79</span><span class="token plain">            UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">80</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">81</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">82</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> product Product</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">83</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">First</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">84</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusNotFound</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;not found&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">85</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">86</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">87</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">88</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ShouldBindJSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">89</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusBadRequest</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">90</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">91</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">92</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">93</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// This Save() call generates an UPDATE audit log with before/after state</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">94</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Save</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">95</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">96</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">97</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">98</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">99</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">100</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">101</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">102</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">DELETE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;/api/products/:id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">103</span><span class="token plain">        ctx </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithRequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">RequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">104</span><span class="token plain">            IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">ClientIP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">105</span><span class="token plain">            UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">    c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">GetString</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user_id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">106</span><span class="token plain">            UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Request</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">UserAgent</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">107</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">108</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">109</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">var</span><span class="token plain"> product Product</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">110</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">First</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Param</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">111</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusNotFound</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;not found&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">112</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">113</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">114</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">115</span><span class="token plain">        </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// This Delete() call generates a DELETE audit log with the before state</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">116</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Delete</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">117</span><span class="token plain">            c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusInternalServerError</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;error&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">118</span><span class="token plain">            </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">119</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">120</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">121</span><span class="token plain">        c</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">JSON</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">http</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">StatusOK</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> gin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">H</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;message&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;deleted&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">122</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">123</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">124</span><span class="token plain">    r</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;:8080&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">125</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h2 id="dashboard">Dashboard</h2><p>The Sentinel dashboard includes a dedicated Audit Logs page that provides a searchable, filterable view of your entire audit trail. Access it at<!-- --> <code>http://localhost:8080/sentinel/ui</code> and navigate to the Audit Logs section.</p><ul><li><strong>Search and filter</strong> — filter audit entries by user ID, action type (CREATE, UPDATE, DELETE), resource (table name), and date range.</li><li><strong>Before/after diff</strong> — expand any UPDATE entry to see the full before and after JSON state side by side.</li><li><strong>User attribution</strong> — each entry shows who performed the action, from which IP, and with which user agent.</li><li><strong>Pagination</strong> — large audit trails are paginated for fast browsing.</li></ul><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Dashboard Access</p><div class="text-sm text-gray-700 dark:text-gray-300">The audit logs page is part of the Sentinel dashboard UI. It is available automatically when you call <code>sentinel.Mount()</code> — no additional configuration is needed beyond setting up the GORM plugin.</div></div></div></div><h2 id="api">API</h2><p>Audit logs are available via the Sentinel REST API. Use the<!-- --> <code>GET /sentinel/api/audit-logs</code> endpoint to query the audit trail programmatically.</p><h3>Query Parameters</h3><table><thead><tr><th>Parameter</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>user_id</code></td><td><code>string</code></td><td>-</td><td>Filter by the user who performed the action.</td></tr><tr><td><code>action</code></td><td><code>string</code></td><td>-</td><td>Filter by action type: <code>CREATE</code>, <code>UPDATE</code>, or <code>DELETE</code>.</td></tr><tr><td><code>resource</code></td><td><code>string</code></td><td>-</td><td>Filter by table name (e.g., <code>users</code>, <code>products</code>).</td></tr><tr><td><code>start_time</code></td><td><code>string</code></td><td>-</td><td>ISO 8601 / RFC 3339 timestamp. Only return entries after this time.</td></tr><tr><td><code>end_time</code></td><td><code>string</code></td><td>-</td><td>ISO 8601 / RFC 3339 timestamp. Only return entries before this time.</td></tr><tr><td><code>page</code></td><td><code>int</code></td><td><code>1</code></td><td>Page number for pagination.</td></tr><tr><td><code>page_size</code></td><td><code>int</code></td><td><code>20</code></td><td>Number of entries per page.</td></tr></tbody></table><h3>Example Request</h3><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token plain">curl &quot;http://localhost:8080/sentinel/api/audit-logs?action=UPDATE&amp;resource=products&amp;page=1&amp;page_size=10&quot;</span></div></pre></div></div><h3>Example Response</h3><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">Response</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">json</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;data&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;a1b2c3d4-e5f6-7890-abcd-ef1234567890&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;timestamp&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;2025-01-15T14:30:00Z&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;user_id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user-42&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;user_email&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;admin@example.com&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;user_role&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;admin&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;action&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;UPDATE&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;resource&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;products&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;resource_id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;7&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;before&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;name&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Widget&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;price&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9.99</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;after&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">7</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;name&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Widget Pro&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">        </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;price&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">14.99</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;ip&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;user_agent&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Mozilla/5.0 ...&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;success&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;request_id&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;req-abc-123&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;meta&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;total&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;page&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token property" style="color:rgb(12, 150, 155)">&quot;page_size&quot;</span><span class="token operator" style="color:rgb(12, 150, 155)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">10</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><h2 id="testing">Testing</h2><p>You can verify that audit entries are being generated by writing a test that collects events from the pipeline. The pattern below uses an in-memory SQLite database and a custom pipeline handler that captures audit events.</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="flex items-center justify-between px-4 py-2 bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800"><span class="text-xs font-mono text-gray-500 dark:text-gray-400">audit_test.go</span><span class="text-xs text-gray-400 dark:text-gray-500 uppercase">go</span></div><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">1</span><span class="token keyword" style="color:rgb(12, 150, 155)">package</span><span class="token plain"> main_test</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">2</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">3</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">4</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;context&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">5</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;sync&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">6</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;testing&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">7</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;time&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">8</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">9</span><span class="token plain">    sentinel </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/core&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">10</span><span class="token plain">    sentinelgorm </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/gorm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">11</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/MUKE-coder/sentinel/pipeline&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">12</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;github.com/glebarez/sqlite&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">13</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;gorm.io/gorm&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">14</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">15</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">16</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> Product </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">17</span><span class="token plain">    ID    </span><span class="token builtin" style="color:rgb(72, 118, 214)">uint</span><span class="token plain">    </span><span class="token string" style="color:rgb(72, 118, 214)">`gorm:&quot;primaryKey&quot; json:&quot;id&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">18</span><span class="token plain">    Name  </span><span class="token builtin" style="color:rgb(72, 118, 214)">string</span><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;name&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">19</span><span class="token plain">    Price </span><span class="token builtin" style="color:rgb(72, 118, 214)">float64</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">`json:&quot;price&quot;`</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">20</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">21</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">22</span><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// auditCollector captures audit events from the pipeline.</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">23</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">type</span><span class="token plain"> auditCollector </span><span class="token keyword" style="color:rgb(12, 150, 155)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">24</span><span class="token plain">    mu     sync</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Mutex</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">25</span><span class="token plain">    audits </span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AuditLog</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">26</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">27</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">28</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ac </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">auditCollector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Handle</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> event pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Event</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(72, 118, 214)">error</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">29</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Type </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">EventAudit </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">30</span><span class="token plain">        </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> al</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ok </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> event</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Payload</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">sentinel</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">AuditLog</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> ok </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">31</span><span class="token plain">            ac</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">mu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Lock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">32</span><span class="token plain">            ac</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">audits </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">append</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ac</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">audits</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> al</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">33</span><span class="token plain">            ac</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">mu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Unlock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">34</span><span class="token plain">        </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">35</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">36</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">37</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">38</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">39</span><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">TestAuditLogging</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">t </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain">testing</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">T</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">40</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Set up pipeline with a collector</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">41</span><span class="token plain">    pipe </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> pipeline</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">42</span><span class="token plain">    collector </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">auditCollector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">43</span><span class="token plain">    pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">AddHandler</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">44</span><span class="token plain">    pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Start</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">45</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">defer</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Stop</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">46</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">47</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Open in-memory SQLite</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">48</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> gorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Open</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sqlite</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Open</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;:memory:&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">gorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Config</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">49</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">50</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Fatal</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">51</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">52</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">53</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Register plugin and migrate</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">54</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Use</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">New</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">55</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">AutoMigrate</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">Product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">56</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">57</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Attach request info</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">58</span><span class="token plain">    ctx </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithRequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">context</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Background</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">sentinelgorm</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">RequestInfo</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">59</span><span class="token plain">        IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain">     </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10.0.0.1&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">60</span><span class="token plain">        UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user-42&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">61</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">62</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">63</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// CREATE — should produce an audit entry</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">64</span><span class="token plain">    product </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> Product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain">Name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Widget&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> Price</span><span class="token punctuation" style="color:rgb(153, 76, 195)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">9.99</span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">65</span><span class="token plain">    db</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">WithContext</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ctx</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Create</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token operator" style="color:rgb(12, 150, 155)">&amp;</span><span class="token plain">product</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">66</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">67</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Wait for async pipeline processing</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">68</span><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Sleep</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> time</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Millisecond</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">69</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">70</span><span class="token plain">    </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Verify the audit entry</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">71</span><span class="token plain">    collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">mu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Lock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">72</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">defer</span><span class="token plain"> collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">mu</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Unlock</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">73</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">74</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">len</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">audits</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">75</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Fatalf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected 1 audit entry, got %d&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">len</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">audits</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">76</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">77</span><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">78</span><span class="token plain">    entry </span><span class="token operator" style="color:rgb(12, 150, 155)">:=</span><span class="token plain"> collector</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">audits</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token number" style="color:rgb(170, 9, 130)">0</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">79</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Action </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;CREATE&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">80</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Errorf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected action CREATE, got %s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Action</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">81</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">82</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Resource </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;products&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">83</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Errorf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected resource products, got %s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">Resource</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">84</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">85</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserID </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;user-42&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">86</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Errorf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected user_id user-42, got %s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">UserID</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">87</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">88</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">IP </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;10.0.0.1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">89</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Errorf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected IP 10.0.0.1, got %s&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">IP</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">90</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">91</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">After </span><span class="token operator" style="color:rgb(12, 150, 155)">==</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(188, 84, 84)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">92</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Error</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected After state to be present&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">93</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">94</span><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">if</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">After</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">&quot;Widget&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">95</span><span class="token plain">        t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">Errorf</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;expected After.name=Widget, got %v&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> entry</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">After</span><span class="token punctuation" style="color:rgb(153, 76, 195)">[</span><span class="token string" style="color:rgb(72, 118, 214)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(153, 76, 195)">]</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">96</span><span class="token plain">    </span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#403f53"><span class="inline-block w-8 text-right mr-4 text-gray-400 dark:text-gray-600 select-none text-xs">97</span><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">}</span></div></pre></div></div><div class="my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800"><div class="flex items-start gap-3"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg><div><p class="font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300">Pipeline is Asynchronous</p><div class="text-sm text-gray-700 dark:text-gray-300">Audit events are processed asynchronously by pipeline workers. In tests, add a short<!-- --> <code>time.Sleep</code> (50-100ms) after database operations to allow the pipeline to flush before asserting on collected audit entries.</div></div></div></div><p>You can also verify audit entries via the API in an integration test by sending an HTTP request and then querying the audit logs endpoint:</p><div class="group relative my-4 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-[#011627]"><div class="relative"><button class="absolute right-3 top-3 z-10 p-1.5 rounded-md bg-gray-100/80 dark:bg-gray-800/80 hover:bg-gray-200 dark:hover:bg-gray-700 opacity-0 group-hover:opacity-100 transition-opacity" aria-label="Copy code"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy text-gray-500 dark:text-gray-400"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button><pre class="overflow-x-auto p-4 text-[13px] leading-relaxed"><div class="token-line" style="color:#403f53"><span class="token plain"># Create a product</span></div><div class="token-line" style="color:#403f53"><span class="token plain">curl -X POST http://localhost:8080/api/products \</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  -H &quot;Content-Type: application/json&quot; \</span></div><div class="token-line" style="color:#403f53"><span class="token plain">  -d &#x27;{&quot;name&quot;: &quot;Widget&quot;, &quot;price&quot;: 9.99}&#x27;</span></div><div class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#403f53"><span class="token plain"># Check audit trail</span></div><div class="token-line" style="color:#403f53"><span class="token plain">curl &quot;http://localhost:8080/sentinel/api/audit-logs?resource=products&amp;action=CREATE&quot;</span></div></pre></div></div><h2>Next Steps</h2><ul><li><a href="/docs/getting-started">Getting Started</a> — Set up the core Sentinel middleware</li><li><a href="/docs/the-dashboard">Dashboard</a> — Browse audit logs and other security data in the UI</li><li><a href="/docs/performance">Performance</a> — Monitor route-level performance alongside audit trails</li><li><a href="/docs/alerting">Alerting</a> — Get notified when threat events occur</li><li><a href="/docs/waf">WAF</a> — Protect your application from common web attacks</li></ul><!--$--><!--/$--></main></div></div><script src="/_next/static/chunks/a339dcc3b98340b3.js" id="_R_" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[82031,[\"/_next/static/chunks/4cc5a908347f559b.js\"],\"ThemeProvider\"]\n3:I[95401,[\"/_next/static/chunks/4cc5a908347f559b.js\"],\"default\"]\n4:I[45121,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n5:I[60512,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n6:I[99113,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"ClientSegmentRoot\"]\n7:I[45693,[\"/_next/static/chunks/4cc5a908347f559b.js\",\"/_next/static/chunks/c23263069b7f7ba3.js\"],\"default\"]\n40:I[50025,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"default\"]\n:HL[\"/_next/static/chunks/a68d47cca58670f5.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"5Swj18oapgqGqSZX8fol6\",\"c\":[\"\",\"docs\",\"audit-logging\"],\"q\":\"\",\"i\":false,\"f\":[[[\"\",{\"children\":[\"docs\",{\"children\":[\"audit-logging\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/chunks/a68d47cca58670f5.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/4cc5a908347f559b.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[\"$\",\"body\",null,{\"className\":\"min-h-screen antialiased\",\"children\":[\"$\",\"$L2\",null,{\"attribute\":\"class\",\"defaultTheme\":\"system\",\"enableSystem\":true,\"children\":[[\"$\",\"$L3\",null,{}],[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}]}]}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/c23263069b7f7ba3.js\",\"async\":true,\"nonce\":\"$undefined\"}]],[\"$\",\"$L6\",null,{\"Component\":\"$7\",\"slots\":{\"children\":[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]},\"serverProvidedParams\":{\"params\":{},\"promises\":[\"$@8\"]}}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L4\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L5\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"h1\",null,{\"children\":\"Audit Logging\"}],[\"$\",\"p\",null,{\"children\":[\"Sentinel includes a GORM plugin that automatically tracks every database mutation — creates, updates, and deletes — and records them as immutable audit log entries. Every change captures \",[\"$\",\"em\",null,{\"children\":\"who\"}],\" made it, \",[\"$\",\"em\",null,{\"children\":\"what\"}],\" changed (including before/after state for updates), and \",[\"$\",\"em\",null,{\"children\":\"when\"}],\" it happened. Audit entries flow through the Sentinel pipeline asynchronously, so your application code is never blocked by audit writes.\"]}],[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Optional Package\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"The GORM audit logging plugin lives in a separate package (\",[\"$\",\"code\",null,{\"children\":\"github.com/MUKE-coder/sentinel/gorm\"}],\"). It is completely optional — your core Sentinel middleware works independently. Import it only if your application uses GORM and you want automatic database-level audit trails.\"]}]]}]]}]}],\"$L9\",\"$La\",\"$Lb\",\"$Lc\",\"$Ld\",\"$Le\",\"$Lf\",\"$L10\",\"$L11\",\"$L12\",\"$L13\",\"$L14\",\"$L15\",\"$L16\",\"$L17\",\"$L18\",\"$L19\",\"$L1a\",\"$L1b\",\"$L1c\",\"$L1d\",\"$L1e\",\"$L1f\",\"$L20\",\"$L21\",\"$L22\",\"$L23\",\"$L24\",\"$L25\",\"$L26\",\"$L27\",\"$L28\",\"$L29\",\"$L2a\",\"$L2b\",\"$L2c\",\"$L2d\",\"$L2e\",\"$L2f\",\"$L30\",\"$L31\",\"$L32\",\"$L33\",\"$L34\",\"$L35\",\"$L36\",\"$L37\",\"$L38\",\"$L39\",\"$L3a\",\"$L3b\",\"$L3c\"],[\"$L3d\"],\"$L3e\"]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],\"$L3f\",false]],\"m\":\"$undefined\",\"G\":[\"$40\",[]],\"S\":true}\n"])</script><script>self.__next_f.push([1,"41:I[99151,[\"/_next/static/chunks/4cc5a908347f559b.js\",\"/_next/static/chunks/c23263069b7f7ba3.js\",\"/_next/static/chunks/2425b678dfc0c3cf.js\"],\"default\"]\n44:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"OutletBoundary\"]\n45:\"$Sreact.suspense\"\n47:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"ViewportBoundary\"]\n49:I[35417,[\"/_next/static/chunks/26ca110782d86623.js\",\"/_next/static/chunks/81f0f13d25d49d65.js\"],\"MetadataBoundary\"]\n9:[\"$\",\"h2\",null,{\"id\":\"installation\",\"children\":\"Installation\"}]\na:[\"$\",\"p\",null,{\"children\":\"The audit logging plugin requires two Sentinel packages: the GORM plugin itself and the event pipeline that transports audit entries to storage.\"}]\nb:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"go imports\",\"code\":\"import (\\n    sentinelgorm \\\"github.com/MUKE-coder/sentinel/gorm\\\"\\n    \\\"github.com/MUKE-coder/sentinel/pipeline\\\"\\n)\"}]\nc:[\"$\",\"p\",null,{\"children\":\"Make sure both packages are available in your module:\"}]\nd:[\"$\",\"$L41\",null,{\"language\":\"bash\",\"showLineNumbers\":false,\"code\":\"go get github.com/MUKE-coder/sentinel/gorm\\ngo get github.com/MUKE-coder/sentinel/pipeline\"}]\ne:[\"$\",\"h2\",null,{\"id\":\"setup\",\"children\":\"Setup\"}]\nf:[\"$\",\"p\",null,{\"children\":\"Setting up audit logging takes three steps: create a pipeline, start its background workers, and register the plugin with your GORM database instance.\"}]\n10:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"main.go\",\"code\":\"// 1. Create an event pipeline with a buffer of 10,000 events\\npipe := pipeline.New(0) // 0 = DefaultBufferSize (10,000)\\n\\n// 2. Start background workers to process audit events\\npipe.Start(2) // 2 worker goroutines\\ndefer pipe.Stop()\\n\\n// 3. Register the Sentinel GORM plugin\\ndb.Use(sentinelgorm.New(pipe))\"}]\n11:[\"$\",\"p\",null,{\"children\":[\"By default, \",[\"$\",\"code\",null,{\"children\":\"sentinelgorm.New(pipe)\"}],\" enables both audit logging and query shielding (N+1 detection, unfiltered query warnings). You can selectively disable features using option functions:\"]}]\n12:[\"$\",\"$L41\",null,{\"language\":\"go\",\"code\":\"// Audit logging only — disable query shielding\\ndb.Use(sentinelgorm.New(pipe, func(c *sentinelgorm.Config) {\\n    c.QueryShieldEnabled = false\\n}))\\n\\n// Query shielding only — disable audit logging\\ndb.Use(sentinelgorm.New(pipe, func(c *sentinelgorm.Config) {\\n    c.AuditEnabled = false\\n}))\"}]\n13:[\"$\",\"h3\",null,{\"children\":\"Plugin Config\"}]\n"])</script><script>self.__next_f.push([1,"14:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Field\"}],[\"$\",\"th\",null,{\"children\":\"Type\"}],[\"$\",\"th\",null,{\"children\":\"Default\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"AuditEnabled\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bool\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"true\"}]}],[\"$\",\"td\",null,{\"children\":\"Enables audit logging for CREATE, UPDATE, and DELETE operations.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"QueryShieldEnabled\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bool\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"true\"}]}],[\"$\",\"td\",null,{\"children\":\"Enables query analysis (N+1 detection, unfiltered query warnings).\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"SlowQueryThreshold\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"time.Duration\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"200ms\"}]}],[\"$\",\"td\",null,{\"children\":\"Queries slower than this duration are flagged.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"N1QueryThreshold\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"int\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"10\"}]}],[\"$\",\"td\",null,{\"children\":\"Number of same-table queries in a single request before flagging as N+1.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"15:[\"$\",\"h2\",null,{\"id\":\"request-context\",\"children\":\"Request Context\"}]\n16:[\"$\",\"p\",null,{\"children\":[\"For audit entries to include \",[\"$\",\"em\",null,{\"children\":\"who\"}],\" performed the action, you need to attach request metadata to the GORM context using \",[\"$\",\"code\",null,{\"children\":\"sentinelgorm.WithRequestInfo()\"}],\". This connects each database operation back to the originating HTTP request.\"]}]\n17:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"handler.go\",\"code\":\"func CreateProductHandler(c *gin.Context) {\\n    // Build request info from the current HTTP request\\n    ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), \u0026sentinelgorm.RequestInfo{\\n        IP:        c.ClientIP(),\\n        UserID:    c.GetString(\\\"user_id\\\"),    // from your auth middleware\\n        UserEmail: c.GetString(\\\"user_email\\\"),\\n        UserRole:  c.GetString(\\\"user_role\\\"),\\n        UserAgent: c.Request.UserAgent(),\\n        RequestID: c.GetString(\\\"request_id\\\"),\\n    })\\n\\n    product := Product{Name: \\\"Widget\\\", Price: 9.99}\\n\\n    // Use db.WithContext(ctx) so the plugin picks up the request info\\n    if err := db.WithContext(ctx).Create(\u0026product).Error; err != nil {\\n        c.JSON(500, gin.H{\\\"error\\\": err.Error()})\\n        return\\n    }\\n\\n    c.JSON(201, product)\\n}\"}]\n"])</script><script>self.__next_f.push([1,"18:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500\",\"children\":[[\"$\",\"path\",\"wmoenq\",{\"d\":\"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3\"}],[\"$\",\"path\",\"juzpu7\",{\"d\":\"M12 9v4\"}],[\"$\",\"path\",\"p32p05\",{\"d\":\"M12 17h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300\",\"children\":\"Context is Required for Attribution\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"If you call \",[\"$\",\"code\",null,{\"children\":\"db.Create(\u0026record)\"}],\" without attaching request info via\",\" \",[\"$\",\"code\",null,{\"children\":\"WithContext\"}],\", the audit entry is still created but the \",[\"$\",\"code\",null,{\"children\":\"UserID\"}],\",\",\" \",[\"$\",\"code\",null,{\"children\":\"IP\"}],\", and \",[\"$\",\"code\",null,{\"children\":\"UserAgent\"}],\" fields will be empty. Always use\",\" \",[\"$\",\"code\",null,{\"children\":\"db.WithContext(ctx)\"}],\" in your HTTP handlers for full attribution.\"]}]]}]]}]}]\n"])</script><script>self.__next_f.push([1,"19:[\"$\",\"h3\",null,{\"children\":\"RequestInfo Fields\"}]\n"])</script><script>self.__next_f.push([1,"1a:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Field\"}],[\"$\",\"th\",null,{\"children\":\"Type\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"IP\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Client IP address of the request originator.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Authenticated user identifier (from your auth middleware).\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserEmail\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Email address of the authenticated user.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserRole\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":[\"Role of the authenticated user (e.g., \",[\"$\",\"code\",null,{\"children\":\"\\\"admin\\\"\"}],\", \",[\"$\",\"code\",null,{\"children\":\"\\\"editor\\\"\"}],\").\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserAgent\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"The User-Agent header from the HTTP request.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"RequestID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Unique request identifier for correlating multiple audit entries from a single request.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1b:[\"$\",\"h2\",null,{\"id\":\"what-gets-logged\",\"children\":\"What Gets Logged\"}]\n1c:[\"$\",\"p\",null,{\"children\":\"The plugin hooks into GORM callbacks for all mutation operations. Every CREATE, UPDATE, and DELETE that passes through GORM produces an audit entry. Read operations (SELECT) are not audited — they are handled separately by the query shield feature.\"}]\n"])</script><script>self.__next_f.push([1,"1d:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Operation\"}],[\"$\",\"th\",null,{\"children\":\"Action Value\"}],[\"$\",\"th\",null,{\"children\":\"Before State\"}],[\"$\",\"th\",null,{\"children\":\"After State\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Create\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"CREATE\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":\"Full record\"}],[\"$\",\"td\",null,{\"children\":\"Captures the complete newly created record.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Update\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UPDATE\"}]}],[\"$\",\"td\",null,{\"children\":\"Record before change\"}],[\"$\",\"td\",null,{\"children\":\"Record after change\"}],[\"$\",\"td\",null,{\"children\":\"Captures both the previous and new state so you can diff exactly what changed.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Delete\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"DELETE\"}]}],[\"$\",\"td\",null,{\"children\":\"Record before deletion\"}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":\"Captures the full record state before it was removed.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"p\",null,{\"children\":\"Each audit entry also records:\"}]\n1f:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Table name\"}],\" — which database table was affected (e.g., \",[\"$\",\"code\",null,{\"children\":\"users\"}],\", \",[\"$\",\"code\",null,{\"children\":\"products\"}],\")\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Record ID\"}],\" — the primary key of the affected record\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"User attribution\"}],\" — UserID, UserEmail, UserRole from the request context\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Request metadata\"}],\" — IP address, User-Agent, RequestID\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Timestamp\"}],\" — when the operation occurred\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Success flag\"}],\" — whether the database operation succeeded\"]}]]}]\n20:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-circle-check-big mt-0.5 flex-shrink-0 text-green-500\",\"children\":[[\"$\",\"path\",\"yps3ct\",{\"d\":\"M21.801 10A10 10 0 1 1 17 3.335\"}],[\"$\",\"path\",\"1pflzl\",{\"d\":\"m9 11 3 3L22 4\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-green-800 dark:text-green-300\",\"children\":\"Before/After Diffing\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"For UPDATE operations, the plugin captures the model state before the update runs (in a\",\" \",[\"$\",\"code\",null,{\"children\":\"Before\"}],\" callback) and after it completes. Both states are serialized as JSON, giving you a complete before/after snapshot that you can diff to see exactly which fields changed.\"]}]]}]]}]}]\n21:[\"$\",\"h2\",null,{\"id\":\"audit-log-model\",\"children\":\"The AuditLog Model\"}]\n22:[\"$\",\"p\",null,{\"children\":[\"Every audit entry is represented by the \",[\"$\",\"code\",null,{\"children\":\"AuditLog\"}],\" struct defined in the\",\" \",[\"$\",\"code\",null,{\"children\":\"core\"}],\" package. This is the shape of the data that gets stored and returned by the API.\"]}]\n23:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"core/models.go\",\"code\":\"// AuditLog represents an immutable audit trail entry.\\ntype AuditLog struct {\\n    ID         string    `json:\\\"id\\\"`\\n    Timestamp  time.Time `json:\\\"timestamp\\\"`\\n    UserID     string    `json:\\\"user_id\\\"`\\n    UserEmail  string    `json:\\\"user_email,omitempty\\\"`\\n    UserRole   string    `json:\\\"user_role,omitempty\\\"`\\n    Action     string    `json:\\\"action\\\"`\\n    Resource   string    `json:\\\"resource\\\"`\\n    ResourceID string    `json:\\\"resource_id\\\"`\\n    Before     JSONMap   `json:\\\"before,omitempty\\\"`\\n    After      JSONMap   `json:\\\"after,omitempty\\\"`\\n    IP         string    `json:\\\"ip\\\"`\\n    UserAgent  string    `json:\\\"user_agent\\\"`\\n    Success    bool      `json:\\\"success\\\"`\\n    Error      string    `json:\\\"error,omitempty\\\"`\\n    RequestID  string    `json:\\\"request_id\\\"`\\n}\"}]\n24:[\"$\",\"h3\",null,{\"children\":\"Field Reference\"}]\n"])</script><script>self.__next_f.push([1,"25:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Field\"}],[\"$\",\"th\",null,{\"children\":\"Type\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"UUID v4 unique identifier for the audit entry.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Timestamp\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"time.Time\"}]}],[\"$\",\"td\",null,{\"children\":\"When the database operation occurred.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"ID of the user who performed the operation.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserEmail\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Email of the user (omitted if empty).\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserRole\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Role of the user (omitted if empty).\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Action\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":[\"The operation type: \",[\"$\",\"code\",null,{\"children\":\"CREATE\"}],\", \",[\"$\",\"code\",null,{\"children\":\"UPDATE\"}],\", or \",[\"$\",\"code\",null,{\"children\":\"DELETE\"}],\".\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Resource\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":[\"The database table name (e.g., \",[\"$\",\"code\",null,{\"children\":\"users\"}],\", \",[\"$\",\"code\",null,{\"children\":\"orders\"}],\").\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"ResourceID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"The primary key value of the affected record.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Before\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"JSONMap\"}]}],[\"$\",\"td\",null,{\"children\":\"JSON snapshot of the record before the change. Present for UPDATE and DELETE; omitted for CREATE.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"After\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"JSONMap\"}]}],[\"$\",\"td\",null,{\"children\":\"JSON snapshot of the record after the change. Present for CREATE and UPDATE; omitted for DELETE.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"IP\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Client IP address from the request context.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"UserAgent\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"User-Agent header from the request context.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Success\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"bool\"}]}],[\"$\",\"td\",null,{\"children\":\"Whether the database operation completed without error.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"Error\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Error message if the operation failed (omitted on success).\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"RequestID\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"Correlation ID to link multiple audit entries from a single HTTP request.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"26:[\"$\",\"h2\",null,{\"id\":\"full-example\",\"children\":\"Full Example\"}]\n27:[\"$\",\"p\",null,{\"children\":[\"The following example shows a complete \",[\"$\",\"code\",null,{\"children\":\"main.go\"}],\" that sets up Sentinel with the GORM audit logging plugin, creates an HTTP handler that attaches request context, and performs a database mutation that produces an audit trail entry.\"]}]\n42:Tf98,"])</script><script>self.__next_f.push([1,"package main\n\nimport (\n    \"net/http\"\n\n    sentinel \"github.com/MUKE-coder/sentinel\"\n    sentinelgorm \"github.com/MUKE-coder/sentinel/gorm\"\n    \"github.com/MUKE-coder/sentinel/pipeline\"\n    \"github.com/gin-gonic/gin\"\n    \"gorm.io/driver/sqlite\"\n    \"gorm.io/gorm\"\n)\n\ntype Product struct {\n    ID    uint    `gorm:\"primaryKey\" json:\"id\"`\n    Name  string  `json:\"name\"`\n    Price float64 `json:\"price\"`\n}\n\nfunc main() {\n    // --- Database setup ---\n    db, err := gorm.Open(sqlite.Open(\"app.db\"), \u0026gorm.Config{})\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    db.AutoMigrate(\u0026Product{})\n\n    // --- Pipeline setup ---\n    pipe := pipeline.New(0) // default 10,000 buffer\n    pipe.Start(2)\n    defer pipe.Stop()\n\n    // --- Register GORM audit plugin ---\n    db.Use(sentinelgorm.New(pipe))\n\n    // --- Gin router ---\n    r := gin.Default()\n\n    // Mount Sentinel middleware + dashboard\n    sentinel.Mount(r, pipe, sentinel.Config{\n        WAF: sentinel.WAFConfig{\n            Enabled: true,\n            Mode:    sentinel.ModeBlock,\n        },\n    })\n\n    // --- Routes ---\n    r.POST(\"/api/products\", func(c *gin.Context) {\n        // Attach request info so audit entries include user attribution\n        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), \u0026sentinelgorm.RequestInfo{\n            IP:        c.ClientIP(),\n            UserID:    c.GetString(\"user_id\"),\n            UserEmail: c.GetString(\"user_email\"),\n            UserRole:  c.GetString(\"user_role\"),\n            UserAgent: c.Request.UserAgent(),\n            RequestID: c.GetHeader(\"X-Request-ID\"),\n        })\n\n        var product Product\n        if err := c.ShouldBindJSON(\u0026product); err != nil {\n            c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        // This Create() call automatically generates an audit log entry\n        if err := db.WithContext(ctx).Create(\u0026product).Error; err != nil {\n            c.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusCreated, product)\n    })\n\n    r.PUT(\"/api/products/:id\", func(c *gin.Context) {\n        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), \u0026sentinelgorm.RequestInfo{\n            IP:        c.ClientIP(),\n            UserID:    c.GetString(\"user_id\"),\n            UserEmail: c.GetString(\"user_email\"),\n            UserAgent: c.Request.UserAgent(),\n        })\n\n        var product Product\n        if err := db.WithContext(ctx).First(\u0026product, c.Param(\"id\")).Error; err != nil {\n            c.JSON(http.StatusNotFound, gin.H{\"error\": \"not found\"})\n            return\n        }\n\n        if err := c.ShouldBindJSON(\u0026product); err != nil {\n            c.JSON(http.StatusBadRequest, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        // This Save() call generates an UPDATE audit log with before/after state\n        if err := db.WithContext(ctx).Save(\u0026product).Error; err != nil {\n            c.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusOK, product)\n    })\n\n    r.DELETE(\"/api/products/:id\", func(c *gin.Context) {\n        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), \u0026sentinelgorm.RequestInfo{\n            IP:        c.ClientIP(),\n            UserID:    c.GetString(\"user_id\"),\n            UserAgent: c.Request.UserAgent(),\n        })\n\n        var product Product\n        if err := db.WithContext(ctx).First(\u0026product, c.Param(\"id\")).Error; err != nil {\n            c.JSON(http.StatusNotFound, gin.H{\"error\": \"not found\"})\n            return\n        }\n\n        // This Delete() call generates a DELETE audit log with the before state\n        if err := db.WithContext(ctx).Delete(\u0026product).Error; err != nil {\n            c.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusOK, gin.H{\"message\": \"deleted\"})\n    })\n\n    r.Run(\":8080\")\n}"])</script><script>self.__next_f.push([1,"28:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"main.go\",\"code\":\"$42\"}]\n29:[\"$\",\"h2\",null,{\"id\":\"dashboard\",\"children\":\"Dashboard\"}]\n2a:[\"$\",\"p\",null,{\"children\":[\"The Sentinel dashboard includes a dedicated Audit Logs page that provides a searchable, filterable view of your entire audit trail. Access it at\",\" \",[\"$\",\"code\",null,{\"children\":\"http://localhost:8080/sentinel/ui\"}],\" and navigate to the Audit Logs section.\"]}]\n2b:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Search and filter\"}],\" — filter audit entries by user ID, action type (CREATE, UPDATE, DELETE), resource (table name), and date range.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Before/after diff\"}],\" — expand any UPDATE entry to see the full before and after JSON state side by side.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"User attribution\"}],\" — each entry shows who performed the action, from which IP, and with which user agent.\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Pagination\"}],\" — large audit trails are paginated for fast browsing.\"]}]]}]\n2c:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Dashboard Access\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"The audit logs page is part of the Sentinel dashboard UI. It is available automatically when you call \",[\"$\",\"code\",null,{\"children\":\"sentinel.Mount()\"}],\" — no additional configuration is needed beyond setting up the GORM plugin.\"]}]]}]]}]}]\n2d:[\"$\",\"h2\",null,{\"id\":\"api\",\"children\":\"API\"}]\n2e:[\"$\",\"p\",null,{\"children\":[\"Audit logs are available via the Sentinel REST API. Use the\",\" \",[\"$\",\"code\",null,{\"children\":\"GET /sentinel/api/audit-logs\"}],\" endpoint to query the audit trail programmatically.\"]}]\n2f:[\"$\",\"h3\",null,{\"children\":\"Query Parameters\"}]\n"])</script><script>self.__next_f.push([1,"30:[\"$\",\"table\",null,{\"children\":[[\"$\",\"thead\",null,{\"children\":[\"$\",\"tr\",null,{\"children\":[[\"$\",\"th\",null,{\"children\":\"Parameter\"}],[\"$\",\"th\",null,{\"children\":\"Type\"}],[\"$\",\"th\",null,{\"children\":\"Default\"}],[\"$\",\"th\",null,{\"children\":\"Description\"}]]}]}],[\"$\",\"tbody\",null,{\"children\":[[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"user_id\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":\"Filter by the user who performed the action.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"action\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":[\"Filter by action type: \",[\"$\",\"code\",null,{\"children\":\"CREATE\"}],\", \",[\"$\",\"code\",null,{\"children\":\"UPDATE\"}],\", or \",[\"$\",\"code\",null,{\"children\":\"DELETE\"}],\".\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"resource\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":[\"Filter by table name (e.g., \",[\"$\",\"code\",null,{\"children\":\"users\"}],\", \",[\"$\",\"code\",null,{\"children\":\"products\"}],\").\"]}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"start_time\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":\"ISO 8601 / RFC 3339 timestamp. Only return entries after this time.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"end_time\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"string\"}]}],[\"$\",\"td\",null,{\"children\":\"-\"}],[\"$\",\"td\",null,{\"children\":\"ISO 8601 / RFC 3339 timestamp. Only return entries before this time.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"page\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"int\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"1\"}]}],[\"$\",\"td\",null,{\"children\":\"Page number for pagination.\"}]]}],[\"$\",\"tr\",null,{\"children\":[[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"page_size\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"int\"}]}],[\"$\",\"td\",null,{\"children\":[\"$\",\"code\",null,{\"children\":\"20\"}]}],[\"$\",\"td\",null,{\"children\":\"Number of entries per page.\"}]]}]]}]]}]\n"])</script><script>self.__next_f.push([1,"31:[\"$\",\"h3\",null,{\"children\":\"Example Request\"}]\n32:[\"$\",\"$L41\",null,{\"language\":\"bash\",\"showLineNumbers\":false,\"code\":\"curl \\\"http://localhost:8080/sentinel/api/audit-logs?action=UPDATE\u0026resource=products\u0026page=1\u0026page_size=10\\\"\"}]\n33:[\"$\",\"h3\",null,{\"children\":\"Example Response\"}]\n34:[\"$\",\"$L41\",null,{\"language\":\"json\",\"filename\":\"Response\",\"showLineNumbers\":false,\"code\":\"{\\n  \\\"data\\\": [\\n    {\\n      \\\"id\\\": \\\"a1b2c3d4-e5f6-7890-abcd-ef1234567890\\\",\\n      \\\"timestamp\\\": \\\"2025-01-15T14:30:00Z\\\",\\n      \\\"user_id\\\": \\\"user-42\\\",\\n      \\\"user_email\\\": \\\"admin@example.com\\\",\\n      \\\"user_role\\\": \\\"admin\\\",\\n      \\\"action\\\": \\\"UPDATE\\\",\\n      \\\"resource\\\": \\\"products\\\",\\n      \\\"resource_id\\\": \\\"7\\\",\\n      \\\"before\\\": {\\n        \\\"id\\\": 7,\\n        \\\"name\\\": \\\"Widget\\\",\\n        \\\"price\\\": 9.99\\n      },\\n      \\\"after\\\": {\\n        \\\"id\\\": 7,\\n        \\\"name\\\": \\\"Widget Pro\\\",\\n        \\\"price\\\": 14.99\\n      },\\n      \\\"ip\\\": \\\"10.0.0.1\\\",\\n      \\\"user_agent\\\": \\\"Mozilla/5.0 ...\\\",\\n      \\\"success\\\": true,\\n      \\\"request_id\\\": \\\"req-abc-123\\\"\\n    }\\n  ],\\n  \\\"meta\\\": {\\n    \\\"total\\\": 1,\\n    \\\"page\\\": 1,\\n    \\\"page_size\\\": 10\\n  }\\n}\"}]\n35:[\"$\",\"h2\",null,{\"id\":\"testing\",\"children\":\"Testing\"}]\n36:[\"$\",\"p\",null,{\"children\":\"You can verify that audit entries are being generated by writing a test that collects events from the pipeline. The pattern below uses an in-memory SQLite database and a custom pipeline handler that captures audit events.\"}]\n43:Ta43,"])</script><script>self.__next_f.push([1,"package main_test\n\nimport (\n    \"context\"\n    \"sync\"\n    \"testing\"\n    \"time\"\n\n    sentinel \"github.com/MUKE-coder/sentinel/core\"\n    sentinelgorm \"github.com/MUKE-coder/sentinel/gorm\"\n    \"github.com/MUKE-coder/sentinel/pipeline\"\n    \"github.com/glebarez/sqlite\"\n    \"gorm.io/gorm\"\n)\n\ntype Product struct {\n    ID    uint    `gorm:\"primaryKey\" json:\"id\"`\n    Name  string  `json:\"name\"`\n    Price float64 `json:\"price\"`\n}\n\n// auditCollector captures audit events from the pipeline.\ntype auditCollector struct {\n    mu     sync.Mutex\n    audits []*sentinel.AuditLog\n}\n\nfunc (ac *auditCollector) Handle(ctx context.Context, event pipeline.Event) error {\n    if event.Type == pipeline.EventAudit {\n        if al, ok := event.Payload.(*sentinel.AuditLog); ok {\n            ac.mu.Lock()\n            ac.audits = append(ac.audits, al)\n            ac.mu.Unlock()\n        }\n    }\n    return nil\n}\n\nfunc TestAuditLogging(t *testing.T) {\n    // Set up pipeline with a collector\n    pipe := pipeline.New(100)\n    collector := \u0026auditCollector{}\n    pipe.AddHandler(collector)\n    pipe.Start(1)\n    defer pipe.Stop()\n\n    // Open in-memory SQLite\n    db, err := gorm.Open(sqlite.Open(\":memory:\"), \u0026gorm.Config{})\n    if err != nil {\n        t.Fatal(err)\n    }\n\n    // Register plugin and migrate\n    db.Use(sentinelgorm.New(pipe))\n    db.AutoMigrate(\u0026Product{})\n\n    // Attach request info\n    ctx := sentinelgorm.WithRequestInfo(context.Background(), \u0026sentinelgorm.RequestInfo{\n        IP:     \"10.0.0.1\",\n        UserID: \"user-42\",\n    })\n\n    // CREATE — should produce an audit entry\n    product := Product{Name: \"Widget\", Price: 9.99}\n    db.WithContext(ctx).Create(\u0026product)\n\n    // Wait for async pipeline processing\n    time.Sleep(100 * time.Millisecond)\n\n    // Verify the audit entry\n    collector.mu.Lock()\n    defer collector.mu.Unlock()\n\n    if len(collector.audits) != 1 {\n        t.Fatalf(\"expected 1 audit entry, got %d\", len(collector.audits))\n    }\n\n    entry := collector.audits[0]\n    if entry.Action != \"CREATE\" {\n        t.Errorf(\"expected action CREATE, got %s\", entry.Action)\n    }\n    if entry.Resource != \"products\" {\n        t.Errorf(\"expected resource products, got %s\", entry.Resource)\n    }\n    if entry.UserID != \"user-42\" {\n        t.Errorf(\"expected user_id user-42, got %s\", entry.UserID)\n    }\n    if entry.IP != \"10.0.0.1\" {\n        t.Errorf(\"expected IP 10.0.0.1, got %s\", entry.IP)\n    }\n    if entry.After == nil {\n        t.Error(\"expected After state to be present\")\n    }\n    if entry.After[\"name\"] != \"Widget\" {\n        t.Errorf(\"expected After.name=Widget, got %v\", entry.After[\"name\"])\n    }\n}"])</script><script>self.__next_f.push([1,"37:[\"$\",\"$L41\",null,{\"language\":\"go\",\"filename\":\"audit_test.go\",\"code\":\"$43\"}]\n38:[\"$\",\"div\",null,{\"className\":\"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex items-start gap-3\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":18,\"height\":18,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500\",\"children\":[[\"$\",\"circle\",\"1mglay\",{\"cx\":\"12\",\"cy\":\"12\",\"r\":\"10\"}],[\"$\",\"path\",\"1dtifu\",{\"d\":\"M12 16v-4\"}],[\"$\",\"path\",\"e9boi3\",{\"d\":\"M12 8h.01\"}],\"$undefined\"]}],[\"$\",\"div\",null,{\"children\":[[\"$\",\"p\",null,{\"className\":\"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300\",\"children\":\"Pipeline is Asynchronous\"}],[\"$\",\"div\",null,{\"className\":\"text-sm text-gray-700 dark:text-gray-300\",\"children\":[\"Audit events are processed asynchronously by pipeline workers. In tests, add a short\",\" \",[\"$\",\"code\",null,{\"children\":\"time.Sleep\"}],\" (50-100ms) after database operations to allow the pipeline to flush before asserting on collected audit entries.\"]}]]}]]}]}]\n39:[\"$\",\"p\",null,{\"children\":\"You can also verify audit entries via the API in an integration test by sending an HTTP request and then querying the audit logs endpoint:\"}]\n3a:[\"$\",\"$L41\",null,{\"language\":\"bash\",\"showLineNumbers\":false,\"code\":\"# Create a product\\ncurl -X POST http://localhost:8080/api/products \\\\\\n  -H \\\"Content-Type: application/json\\\" \\\\\\n  -d '{\\\"name\\\": \\\"Widget\\\", \\\"price\\\": 9.99}'\\n\\n# Check audit trail\\ncurl \\\"http://localhost:8080/sentinel/api/audit-logs?resource=products\u0026action=CREATE\\\"\"}]\n3b:[\"$\",\"h2\",null,{\"children\":\"Next Steps\"}]\n3c:[\"$\",\"ul\",null,{\"children\":[[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/getting-started\",\"children\":\"Getting Started\"}],\" — Set up the core Sentinel middleware\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/the-dashboard\",\"children\":\"Dashboard\"}],\" — Browse audit logs and other security data in the UI\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/performance\",\"children\":\"Performance\"}],\" — Monitor route-level performance alongside audit trails\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/alerting\",\"children\":\"Alerting\"}],\" — Get notified when threat events occur\"]}],[\"$\",\"li\",null,{\"children\":[[\"$\",\"a\",null,{\"href\":\"/docs/waf\",\"children\":\"WAF\"}],\" — Protect your application from common web attacks\"]}]]}]\n3d:[\"$\",\"script\",\"script-0\",{\"src\":\"/_next/static/chunks/2425b678dfc0c3cf.js\",\"async\":true,\"nonce\":\"$undefined\"}]\n3e:[\"$\",\"$L44\",null,{\"children\":[\"$\",\"$45\",null,{\"name\":\"Next.MetadataOutlet\",\"children\":\"$@46\"}]}]\n3f:[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$L47\",null,{\"children\":\"$L48\"}],[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$L49\",null,{\"children\":[\"$\",\"$45\",null,{\"name\":\"Next.Metadata\",\"children\":\"$L4a\"}]}]}],null]}]\n8:\"$0:f:0:1:1:children:0:props:children:1:props:serverProvidedParams:params\"\n"])</script><script>self.__next_f.push([1,"48:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n"])</script><script>self.__next_f.push([1,"46:null\n4a:[[\"$\",\"title\",\"0\",{\"children\":\"Audit Logging - Sentinel Docs\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Production-grade security middleware for Go/Gin applications. WAF, rate limiting, threat detection, AI analysis, and an embedded dashboard.\"}]]\n"])</script></body></html>