1:"$Sreact.fragment"
2:I[82031,["/_next/static/chunks/4cc5a908347f559b.js"],"ThemeProvider"]
3:I[95401,["/_next/static/chunks/4cc5a908347f559b.js"],"default"]
4:I[45121,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"default"]
5:I[60512,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"default"]
6:I[99113,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"ClientSegmentRoot"]
7:I[45693,["/_next/static/chunks/4cc5a908347f559b.js","/_next/static/chunks/c23263069b7f7ba3.js"],"default"]
40:I[50025,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"default"]
:HL["/_next/static/chunks/a68d47cca58670f5.css","style"]
0:{"P":null,"b":"5Swj18oapgqGqSZX8fol6","c":["","docs","audit-logging"],"q":"","i":false,"f":[[["",{"children":["docs",{"children":["audit-logging",{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/chunks/a68d47cca58670f5.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","script","script-0",{"src":"/_next/static/chunks/4cc5a908347f559b.js","async":true,"nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"min-h-screen antialiased","children":["$","$L2",null,{"attribute":"class","defaultTheme":"system","enableSystem":true,"children":[["$","$L3",null,{}],["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]]}]}]}]]}],{"children":[["$","$1","c",{"children":[[["$","script","script-0",{"src":"/_next/static/chunks/c23263069b7f7ba3.js","async":true,"nonce":"$undefined"}]],["$","$L6",null,{"Component":"$7","slots":{"children":["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]},"serverProvidedParams":{"params":{},"promises":["$@8"]}}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L4",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L5",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[[["$","h1",null,{"children":"Audit Logging"}],["$","p",null,{"children":["Sentinel includes a GORM plugin that automatically tracks every database mutation — creates, updates, and deletes — and records them as immutable audit log entries. Every change captures ",["$","em",null,{"children":"who"}]," made it, ",["$","em",null,{"children":"what"}]," changed (including before/after state for updates), and ",["$","em",null,{"children":"when"}]," it happened. Audit entries flow through the Sentinel pipeline asynchronously, so your application code is never blocked by audit writes."]}],["$","div",null,{"className":"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800","children":["$","div",null,{"className":"flex items-start gap-3","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":18,"height":18,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500","children":[["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],["$","path","1dtifu",{"d":"M12 16v-4"}],["$","path","e9boi3",{"d":"M12 8h.01"}],"$undefined"]}],["$","div",null,{"children":[["$","p",null,{"className":"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300","children":"Optional Package"}],["$","div",null,{"className":"text-sm text-gray-700 dark:text-gray-300","children":["The GORM audit logging plugin lives in a separate package (",["$","code",null,{"children":"github.com/MUKE-coder/sentinel/gorm"}],"). It is completely optional — your core Sentinel middleware works independently. Import it only if your application uses GORM and you want automatic database-level audit trails."]}]]}]]}]}],"$L9","$La","$Lb","$Lc","$Ld","$Le","$Lf","$L10","$L11","$L12","$L13","$L14","$L15","$L16","$L17","$L18","$L19","$L1a","$L1b","$L1c","$L1d","$L1e","$L1f","$L20","$L21","$L22","$L23","$L24","$L25","$L26","$L27","$L28","$L29","$L2a","$L2b","$L2c","$L2d","$L2e","$L2f","$L30","$L31","$L32","$L33","$L34","$L35","$L36","$L37","$L38","$L39","$L3a","$L3b","$L3c"],["$L3d"],"$L3e"]}],{},null,false,false]},null,false,false]},null,false,false]},null,false,false],"$L3f",false]],"m":"$undefined","G":["$40",[]],"S":true}
41:I[99151,["/_next/static/chunks/4cc5a908347f559b.js","/_next/static/chunks/c23263069b7f7ba3.js","/_next/static/chunks/2425b678dfc0c3cf.js"],"default"]
44:I[35417,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"OutletBoundary"]
45:"$Sreact.suspense"
47:I[35417,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"ViewportBoundary"]
49:I[35417,["/_next/static/chunks/26ca110782d86623.js","/_next/static/chunks/81f0f13d25d49d65.js"],"MetadataBoundary"]
9:["$","h2",null,{"id":"installation","children":"Installation"}]
a:["$","p",null,{"children":"The audit logging plugin requires two Sentinel packages: the GORM plugin itself and the event pipeline that transports audit entries to storage."}]
b:["$","$L41",null,{"language":"go","filename":"go imports","code":"import (\n    sentinelgorm \"github.com/MUKE-coder/sentinel/gorm\"\n    \"github.com/MUKE-coder/sentinel/pipeline\"\n)"}]
c:["$","p",null,{"children":"Make sure both packages are available in your module:"}]
d:["$","$L41",null,{"language":"bash","showLineNumbers":false,"code":"go get github.com/MUKE-coder/sentinel/gorm\ngo get github.com/MUKE-coder/sentinel/pipeline"}]
e:["$","h2",null,{"id":"setup","children":"Setup"}]
f:["$","p",null,{"children":"Setting up audit logging takes three steps: create a pipeline, start its background workers, and register the plugin with your GORM database instance."}]
10:["$","$L41",null,{"language":"go","filename":"main.go","code":"// 1. Create an event pipeline with a buffer of 10,000 events\npipe := pipeline.New(0) // 0 = DefaultBufferSize (10,000)\n\n// 2. Start background workers to process audit events\npipe.Start(2) // 2 worker goroutines\ndefer pipe.Stop()\n\n// 3. Register the Sentinel GORM plugin\ndb.Use(sentinelgorm.New(pipe))"}]
11:["$","p",null,{"children":["By default, ",["$","code",null,{"children":"sentinelgorm.New(pipe)"}]," enables both audit logging and query shielding (N+1 detection, unfiltered query warnings). You can selectively disable features using option functions:"]}]
12:["$","$L41",null,{"language":"go","code":"// Audit logging only — disable query shielding\ndb.Use(sentinelgorm.New(pipe, func(c *sentinelgorm.Config) {\n    c.QueryShieldEnabled = false\n}))\n\n// Query shielding only — disable audit logging\ndb.Use(sentinelgorm.New(pipe, func(c *sentinelgorm.Config) {\n    c.AuditEnabled = false\n}))"}]
13:["$","h3",null,{"children":"Plugin Config"}]
14:["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Field"}],["$","th",null,{"children":"Type"}],["$","th",null,{"children":"Default"}],["$","th",null,{"children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"AuditEnabled"}]}],["$","td",null,{"children":["$","code",null,{"children":"bool"}]}],["$","td",null,{"children":["$","code",null,{"children":"true"}]}],["$","td",null,{"children":"Enables audit logging for CREATE, UPDATE, and DELETE operations."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"QueryShieldEnabled"}]}],["$","td",null,{"children":["$","code",null,{"children":"bool"}]}],["$","td",null,{"children":["$","code",null,{"children":"true"}]}],["$","td",null,{"children":"Enables query analysis (N+1 detection, unfiltered query warnings)."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"SlowQueryThreshold"}]}],["$","td",null,{"children":["$","code",null,{"children":"time.Duration"}]}],["$","td",null,{"children":["$","code",null,{"children":"200ms"}]}],["$","td",null,{"children":"Queries slower than this duration are flagged."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"N1QueryThreshold"}]}],["$","td",null,{"children":["$","code",null,{"children":"int"}]}],["$","td",null,{"children":["$","code",null,{"children":"10"}]}],["$","td",null,{"children":"Number of same-table queries in a single request before flagging as N+1."}]]}]]}]]}]
15:["$","h2",null,{"id":"request-context","children":"Request Context"}]
16:["$","p",null,{"children":["For audit entries to include ",["$","em",null,{"children":"who"}]," performed the action, you need to attach request metadata to the GORM context using ",["$","code",null,{"children":"sentinelgorm.WithRequestInfo()"}],". This connects each database operation back to the originating HTTP request."]}]
17:["$","$L41",null,{"language":"go","filename":"handler.go","code":"func CreateProductHandler(c *gin.Context) {\n    // Build request info from the current HTTP request\n    ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), &sentinelgorm.RequestInfo{\n        IP:        c.ClientIP(),\n        UserID:    c.GetString(\"user_id\"),    // from your auth middleware\n        UserEmail: c.GetString(\"user_email\"),\n        UserRole:  c.GetString(\"user_role\"),\n        UserAgent: c.Request.UserAgent(),\n        RequestID: c.GetString(\"request_id\"),\n    })\n\n    product := Product{Name: \"Widget\", Price: 9.99}\n\n    // Use db.WithContext(ctx) so the plugin picks up the request info\n    if err := db.WithContext(ctx).Create(&product).Error; err != nil {\n        c.JSON(500, gin.H{\"error\": err.Error()})\n        return\n    }\n\n    c.JSON(201, product)\n}"}]
18:["$","div",null,{"className":"my-4 rounded-lg border p-4 bg-amber-50 dark:bg-amber-950/30 border-amber-200 dark:border-amber-800","children":["$","div",null,{"className":"flex items-start gap-3","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":18,"height":18,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-triangle-alert mt-0.5 flex-shrink-0 text-amber-500","children":[["$","path","wmoenq",{"d":"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"}],["$","path","juzpu7",{"d":"M12 9v4"}],["$","path","p32p05",{"d":"M12 17h.01"}],"$undefined"]}],["$","div",null,{"children":[["$","p",null,{"className":"font-semibold text-sm mb-1 text-amber-800 dark:text-amber-300","children":"Context is Required for Attribution"}],["$","div",null,{"className":"text-sm text-gray-700 dark:text-gray-300","children":["If you call ",["$","code",null,{"children":"db.Create(&record)"}]," without attaching request info via"," ",["$","code",null,{"children":"WithContext"}],", the audit entry is still created but the ",["$","code",null,{"children":"UserID"}],","," ",["$","code",null,{"children":"IP"}],", and ",["$","code",null,{"children":"UserAgent"}]," fields will be empty. Always use"," ",["$","code",null,{"children":"db.WithContext(ctx)"}]," in your HTTP handlers for full attribution."]}]]}]]}]}]
19:["$","h3",null,{"children":"RequestInfo Fields"}]
1a:["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Field"}],["$","th",null,{"children":"Type"}],["$","th",null,{"children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"IP"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Client IP address of the request originator."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Authenticated user identifier (from your auth middleware)."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserEmail"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Email address of the authenticated user."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserRole"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":["Role of the authenticated user (e.g., ",["$","code",null,{"children":"\"admin\""}],", ",["$","code",null,{"children":"\"editor\""}],")."]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserAgent"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"The User-Agent header from the HTTP request."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"RequestID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Unique request identifier for correlating multiple audit entries from a single request."}]]}]]}]]}]
1b:["$","h2",null,{"id":"what-gets-logged","children":"What Gets Logged"}]
1c:["$","p",null,{"children":"The plugin hooks into GORM callbacks for all mutation operations. Every CREATE, UPDATE, and DELETE that passes through GORM produces an audit entry. Read operations (SELECT) are not audited — they are handled separately by the query shield feature."}]
1d:["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Operation"}],["$","th",null,{"children":"Action Value"}],["$","th",null,{"children":"Before State"}],["$","th",null,{"children":"After State"}],["$","th",null,{"children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","strong",null,{"children":"Create"}]}],["$","td",null,{"children":["$","code",null,{"children":"CREATE"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":"Full record"}],["$","td",null,{"children":"Captures the complete newly created record."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","strong",null,{"children":"Update"}]}],["$","td",null,{"children":["$","code",null,{"children":"UPDATE"}]}],["$","td",null,{"children":"Record before change"}],["$","td",null,{"children":"Record after change"}],["$","td",null,{"children":"Captures both the previous and new state so you can diff exactly what changed."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","strong",null,{"children":"Delete"}]}],["$","td",null,{"children":["$","code",null,{"children":"DELETE"}]}],["$","td",null,{"children":"Record before deletion"}],["$","td",null,{"children":"-"}],["$","td",null,{"children":"Captures the full record state before it was removed."}]]}]]}]]}]
1e:["$","p",null,{"children":"Each audit entry also records:"}]
1f:["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Table name"}]," — which database table was affected (e.g., ",["$","code",null,{"children":"users"}],", ",["$","code",null,{"children":"products"}],")"]}],["$","li",null,{"children":[["$","strong",null,{"children":"Record ID"}]," — the primary key of the affected record"]}],["$","li",null,{"children":[["$","strong",null,{"children":"User attribution"}]," — UserID, UserEmail, UserRole from the request context"]}],["$","li",null,{"children":[["$","strong",null,{"children":"Request metadata"}]," — IP address, User-Agent, RequestID"]}],["$","li",null,{"children":[["$","strong",null,{"children":"Timestamp"}]," — when the operation occurred"]}],["$","li",null,{"children":[["$","strong",null,{"children":"Success flag"}]," — whether the database operation succeeded"]}]]}]
20:["$","div",null,{"className":"my-4 rounded-lg border p-4 bg-green-50 dark:bg-green-950/30 border-green-200 dark:border-green-800","children":["$","div",null,{"className":"flex items-start gap-3","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":18,"height":18,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-circle-check-big mt-0.5 flex-shrink-0 text-green-500","children":[["$","path","yps3ct",{"d":"M21.801 10A10 10 0 1 1 17 3.335"}],["$","path","1pflzl",{"d":"m9 11 3 3L22 4"}],"$undefined"]}],["$","div",null,{"children":[["$","p",null,{"className":"font-semibold text-sm mb-1 text-green-800 dark:text-green-300","children":"Before/After Diffing"}],["$","div",null,{"className":"text-sm text-gray-700 dark:text-gray-300","children":["For UPDATE operations, the plugin captures the model state before the update runs (in a"," ",["$","code",null,{"children":"Before"}]," callback) and after it completes. Both states are serialized as JSON, giving you a complete before/after snapshot that you can diff to see exactly which fields changed."]}]]}]]}]}]
21:["$","h2",null,{"id":"audit-log-model","children":"The AuditLog Model"}]
22:["$","p",null,{"children":["Every audit entry is represented by the ",["$","code",null,{"children":"AuditLog"}]," struct defined in the"," ",["$","code",null,{"children":"core"}]," package. This is the shape of the data that gets stored and returned by the API."]}]
23:["$","$L41",null,{"language":"go","filename":"core/models.go","code":"// AuditLog represents an immutable audit trail entry.\ntype AuditLog struct {\n    ID         string    `json:\"id\"`\n    Timestamp  time.Time `json:\"timestamp\"`\n    UserID     string    `json:\"user_id\"`\n    UserEmail  string    `json:\"user_email,omitempty\"`\n    UserRole   string    `json:\"user_role,omitempty\"`\n    Action     string    `json:\"action\"`\n    Resource   string    `json:\"resource\"`\n    ResourceID string    `json:\"resource_id\"`\n    Before     JSONMap   `json:\"before,omitempty\"`\n    After      JSONMap   `json:\"after,omitempty\"`\n    IP         string    `json:\"ip\"`\n    UserAgent  string    `json:\"user_agent\"`\n    Success    bool      `json:\"success\"`\n    Error      string    `json:\"error,omitempty\"`\n    RequestID  string    `json:\"request_id\"`\n}"}]
24:["$","h3",null,{"children":"Field Reference"}]
25:["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Field"}],["$","th",null,{"children":"Type"}],["$","th",null,{"children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"ID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"UUID v4 unique identifier for the audit entry."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Timestamp"}]}],["$","td",null,{"children":["$","code",null,{"children":"time.Time"}]}],["$","td",null,{"children":"When the database operation occurred."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"ID of the user who performed the operation."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserEmail"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Email of the user (omitted if empty)."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserRole"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Role of the user (omitted if empty)."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Action"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":["The operation type: ",["$","code",null,{"children":"CREATE"}],", ",["$","code",null,{"children":"UPDATE"}],", or ",["$","code",null,{"children":"DELETE"}],"."]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Resource"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":["The database table name (e.g., ",["$","code",null,{"children":"users"}],", ",["$","code",null,{"children":"orders"}],")."]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"ResourceID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"The primary key value of the affected record."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Before"}]}],["$","td",null,{"children":["$","code",null,{"children":"JSONMap"}]}],["$","td",null,{"children":"JSON snapshot of the record before the change. Present for UPDATE and DELETE; omitted for CREATE."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"After"}]}],["$","td",null,{"children":["$","code",null,{"children":"JSONMap"}]}],["$","td",null,{"children":"JSON snapshot of the record after the change. Present for CREATE and UPDATE; omitted for DELETE."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"IP"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Client IP address from the request context."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"UserAgent"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"User-Agent header from the request context."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Success"}]}],["$","td",null,{"children":["$","code",null,{"children":"bool"}]}],["$","td",null,{"children":"Whether the database operation completed without error."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"Error"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Error message if the operation failed (omitted on success)."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"RequestID"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"Correlation ID to link multiple audit entries from a single HTTP request."}]]}]]}]]}]
26:["$","h2",null,{"id":"full-example","children":"Full Example"}]
27:["$","p",null,{"children":["The following example shows a complete ",["$","code",null,{"children":"main.go"}]," that sets up Sentinel with the GORM audit logging plugin, creates an HTTP handler that attaches request context, and performs a database mutation that produces an audit trail entry."]}]
42:Tf98,package main

import (
    "net/http"

    sentinel "github.com/MUKE-coder/sentinel"
    sentinelgorm "github.com/MUKE-coder/sentinel/gorm"
    "github.com/MUKE-coder/sentinel/pipeline"
    "github.com/gin-gonic/gin"
    "gorm.io/driver/sqlite"
    "gorm.io/gorm"
)

type Product struct {
    ID    uint    `gorm:"primaryKey" json:"id"`
    Name  string  `json:"name"`
    Price float64 `json:"price"`
}

func main() {
    // --- Database setup ---
    db, err := gorm.Open(sqlite.Open("app.db"), &gorm.Config{})
    if err != nil {
        panic("failed to connect database")
    }
    db.AutoMigrate(&Product{})

    // --- Pipeline setup ---
    pipe := pipeline.New(0) // default 10,000 buffer
    pipe.Start(2)
    defer pipe.Stop()

    // --- Register GORM audit plugin ---
    db.Use(sentinelgorm.New(pipe))

    // --- Gin router ---
    r := gin.Default()

    // Mount Sentinel middleware + dashboard
    sentinel.Mount(r, pipe, sentinel.Config{
        WAF: sentinel.WAFConfig{
            Enabled: true,
            Mode:    sentinel.ModeBlock,
        },
    })

    // --- Routes ---
    r.POST("/api/products", func(c *gin.Context) {
        // Attach request info so audit entries include user attribution
        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), &sentinelgorm.RequestInfo{
            IP:        c.ClientIP(),
            UserID:    c.GetString("user_id"),
            UserEmail: c.GetString("user_email"),
            UserRole:  c.GetString("user_role"),
            UserAgent: c.Request.UserAgent(),
            RequestID: c.GetHeader("X-Request-ID"),
        })

        var product Product
        if err := c.ShouldBindJSON(&product); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
            return
        }

        // This Create() call automatically generates an audit log entry
        if err := db.WithContext(ctx).Create(&product).Error; err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
            return
        }

        c.JSON(http.StatusCreated, product)
    })

    r.PUT("/api/products/:id", func(c *gin.Context) {
        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), &sentinelgorm.RequestInfo{
            IP:        c.ClientIP(),
            UserID:    c.GetString("user_id"),
            UserEmail: c.GetString("user_email"),
            UserAgent: c.Request.UserAgent(),
        })

        var product Product
        if err := db.WithContext(ctx).First(&product, c.Param("id")).Error; err != nil {
            c.JSON(http.StatusNotFound, gin.H{"error": "not found"})
            return
        }

        if err := c.ShouldBindJSON(&product); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
            return
        }

        // This Save() call generates an UPDATE audit log with before/after state
        if err := db.WithContext(ctx).Save(&product).Error; err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
            return
        }

        c.JSON(http.StatusOK, product)
    })

    r.DELETE("/api/products/:id", func(c *gin.Context) {
        ctx := sentinelgorm.WithRequestInfo(c.Request.Context(), &sentinelgorm.RequestInfo{
            IP:        c.ClientIP(),
            UserID:    c.GetString("user_id"),
            UserAgent: c.Request.UserAgent(),
        })

        var product Product
        if err := db.WithContext(ctx).First(&product, c.Param("id")).Error; err != nil {
            c.JSON(http.StatusNotFound, gin.H{"error": "not found"})
            return
        }

        // This Delete() call generates a DELETE audit log with the before state
        if err := db.WithContext(ctx).Delete(&product).Error; err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})
            return
        }

        c.JSON(http.StatusOK, gin.H{"message": "deleted"})
    })

    r.Run(":8080")
}28:["$","$L41",null,{"language":"go","filename":"main.go","code":"$42"}]
29:["$","h2",null,{"id":"dashboard","children":"Dashboard"}]
2a:["$","p",null,{"children":["The Sentinel dashboard includes a dedicated Audit Logs page that provides a searchable, filterable view of your entire audit trail. Access it at"," ",["$","code",null,{"children":"http://localhost:8080/sentinel/ui"}]," and navigate to the Audit Logs section."]}]
2b:["$","ul",null,{"children":[["$","li",null,{"children":[["$","strong",null,{"children":"Search and filter"}]," — filter audit entries by user ID, action type (CREATE, UPDATE, DELETE), resource (table name), and date range."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Before/after diff"}]," — expand any UPDATE entry to see the full before and after JSON state side by side."]}],["$","li",null,{"children":[["$","strong",null,{"children":"User attribution"}]," — each entry shows who performed the action, from which IP, and with which user agent."]}],["$","li",null,{"children":[["$","strong",null,{"children":"Pagination"}]," — large audit trails are paginated for fast browsing."]}]]}]
2c:["$","div",null,{"className":"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800","children":["$","div",null,{"className":"flex items-start gap-3","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":18,"height":18,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500","children":[["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],["$","path","1dtifu",{"d":"M12 16v-4"}],["$","path","e9boi3",{"d":"M12 8h.01"}],"$undefined"]}],["$","div",null,{"children":[["$","p",null,{"className":"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300","children":"Dashboard Access"}],["$","div",null,{"className":"text-sm text-gray-700 dark:text-gray-300","children":["The audit logs page is part of the Sentinel dashboard UI. It is available automatically when you call ",["$","code",null,{"children":"sentinel.Mount()"}]," — no additional configuration is needed beyond setting up the GORM plugin."]}]]}]]}]}]
2d:["$","h2",null,{"id":"api","children":"API"}]
2e:["$","p",null,{"children":["Audit logs are available via the Sentinel REST API. Use the"," ",["$","code",null,{"children":"GET /sentinel/api/audit-logs"}]," endpoint to query the audit trail programmatically."]}]
2f:["$","h3",null,{"children":"Query Parameters"}]
30:["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"Parameter"}],["$","th",null,{"children":"Type"}],["$","th",null,{"children":"Default"}],["$","th",null,{"children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"user_id"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":"Filter by the user who performed the action."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"action"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":["Filter by action type: ",["$","code",null,{"children":"CREATE"}],", ",["$","code",null,{"children":"UPDATE"}],", or ",["$","code",null,{"children":"DELETE"}],"."]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"resource"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":["Filter by table name (e.g., ",["$","code",null,{"children":"users"}],", ",["$","code",null,{"children":"products"}],")."]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"start_time"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":"ISO 8601 / RFC 3339 timestamp. Only return entries after this time."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"end_time"}]}],["$","td",null,{"children":["$","code",null,{"children":"string"}]}],["$","td",null,{"children":"-"}],["$","td",null,{"children":"ISO 8601 / RFC 3339 timestamp. Only return entries before this time."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"page"}]}],["$","td",null,{"children":["$","code",null,{"children":"int"}]}],["$","td",null,{"children":["$","code",null,{"children":"1"}]}],["$","td",null,{"children":"Page number for pagination."}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"page_size"}]}],["$","td",null,{"children":["$","code",null,{"children":"int"}]}],["$","td",null,{"children":["$","code",null,{"children":"20"}]}],["$","td",null,{"children":"Number of entries per page."}]]}]]}]]}]
31:["$","h3",null,{"children":"Example Request"}]
32:["$","$L41",null,{"language":"bash","showLineNumbers":false,"code":"curl \"http://localhost:8080/sentinel/api/audit-logs?action=UPDATE&resource=products&page=1&page_size=10\""}]
33:["$","h3",null,{"children":"Example Response"}]
34:["$","$L41",null,{"language":"json","filename":"Response","showLineNumbers":false,"code":"{\n  \"data\": [\n    {\n      \"id\": \"a1b2c3d4-e5f6-7890-abcd-ef1234567890\",\n      \"timestamp\": \"2025-01-15T14:30:00Z\",\n      \"user_id\": \"user-42\",\n      \"user_email\": \"admin@example.com\",\n      \"user_role\": \"admin\",\n      \"action\": \"UPDATE\",\n      \"resource\": \"products\",\n      \"resource_id\": \"7\",\n      \"before\": {\n        \"id\": 7,\n        \"name\": \"Widget\",\n        \"price\": 9.99\n      },\n      \"after\": {\n        \"id\": 7,\n        \"name\": \"Widget Pro\",\n        \"price\": 14.99\n      },\n      \"ip\": \"10.0.0.1\",\n      \"user_agent\": \"Mozilla/5.0 ...\",\n      \"success\": true,\n      \"request_id\": \"req-abc-123\"\n    }\n  ],\n  \"meta\": {\n    \"total\": 1,\n    \"page\": 1,\n    \"page_size\": 10\n  }\n}"}]
35:["$","h2",null,{"id":"testing","children":"Testing"}]
36:["$","p",null,{"children":"You can verify that audit entries are being generated by writing a test that collects events from the pipeline. The pattern below uses an in-memory SQLite database and a custom pipeline handler that captures audit events."}]
43:Ta43,package main_test

import (
    "context"
    "sync"
    "testing"
    "time"

    sentinel "github.com/MUKE-coder/sentinel/core"
    sentinelgorm "github.com/MUKE-coder/sentinel/gorm"
    "github.com/MUKE-coder/sentinel/pipeline"
    "github.com/glebarez/sqlite"
    "gorm.io/gorm"
)

type Product struct {
    ID    uint    `gorm:"primaryKey" json:"id"`
    Name  string  `json:"name"`
    Price float64 `json:"price"`
}

// auditCollector captures audit events from the pipeline.
type auditCollector struct {
    mu     sync.Mutex
    audits []*sentinel.AuditLog
}

func (ac *auditCollector) Handle(ctx context.Context, event pipeline.Event) error {
    if event.Type == pipeline.EventAudit {
        if al, ok := event.Payload.(*sentinel.AuditLog); ok {
            ac.mu.Lock()
            ac.audits = append(ac.audits, al)
            ac.mu.Unlock()
        }
    }
    return nil
}

func TestAuditLogging(t *testing.T) {
    // Set up pipeline with a collector
    pipe := pipeline.New(100)
    collector := &auditCollector{}
    pipe.AddHandler(collector)
    pipe.Start(1)
    defer pipe.Stop()

    // Open in-memory SQLite
    db, err := gorm.Open(sqlite.Open(":memory:"), &gorm.Config{})
    if err != nil {
        t.Fatal(err)
    }

    // Register plugin and migrate
    db.Use(sentinelgorm.New(pipe))
    db.AutoMigrate(&Product{})

    // Attach request info
    ctx := sentinelgorm.WithRequestInfo(context.Background(), &sentinelgorm.RequestInfo{
        IP:     "10.0.0.1",
        UserID: "user-42",
    })

    // CREATE — should produce an audit entry
    product := Product{Name: "Widget", Price: 9.99}
    db.WithContext(ctx).Create(&product)

    // Wait for async pipeline processing
    time.Sleep(100 * time.Millisecond)

    // Verify the audit entry
    collector.mu.Lock()
    defer collector.mu.Unlock()

    if len(collector.audits) != 1 {
        t.Fatalf("expected 1 audit entry, got %d", len(collector.audits))
    }

    entry := collector.audits[0]
    if entry.Action != "CREATE" {
        t.Errorf("expected action CREATE, got %s", entry.Action)
    }
    if entry.Resource != "products" {
        t.Errorf("expected resource products, got %s", entry.Resource)
    }
    if entry.UserID != "user-42" {
        t.Errorf("expected user_id user-42, got %s", entry.UserID)
    }
    if entry.IP != "10.0.0.1" {
        t.Errorf("expected IP 10.0.0.1, got %s", entry.IP)
    }
    if entry.After == nil {
        t.Error("expected After state to be present")
    }
    if entry.After["name"] != "Widget" {
        t.Errorf("expected After.name=Widget, got %v", entry.After["name"])
    }
}37:["$","$L41",null,{"language":"go","filename":"audit_test.go","code":"$43"}]
38:["$","div",null,{"className":"my-4 rounded-lg border p-4 bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-800","children":["$","div",null,{"className":"flex items-start gap-3","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":18,"height":18,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-info mt-0.5 flex-shrink-0 text-blue-500","children":[["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],["$","path","1dtifu",{"d":"M12 16v-4"}],["$","path","e9boi3",{"d":"M12 8h.01"}],"$undefined"]}],["$","div",null,{"children":[["$","p",null,{"className":"font-semibold text-sm mb-1 text-blue-800 dark:text-blue-300","children":"Pipeline is Asynchronous"}],["$","div",null,{"className":"text-sm text-gray-700 dark:text-gray-300","children":["Audit events are processed asynchronously by pipeline workers. In tests, add a short"," ",["$","code",null,{"children":"time.Sleep"}]," (50-100ms) after database operations to allow the pipeline to flush before asserting on collected audit entries."]}]]}]]}]}]
39:["$","p",null,{"children":"You can also verify audit entries via the API in an integration test by sending an HTTP request and then querying the audit logs endpoint:"}]
3a:["$","$L41",null,{"language":"bash","showLineNumbers":false,"code":"# Create a product\ncurl -X POST http://localhost:8080/api/products \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\": \"Widget\", \"price\": 9.99}'\n\n# Check audit trail\ncurl \"http://localhost:8080/sentinel/api/audit-logs?resource=products&action=CREATE\""}]
3b:["$","h2",null,{"children":"Next Steps"}]
3c:["$","ul",null,{"children":[["$","li",null,{"children":[["$","a",null,{"href":"/docs/getting-started","children":"Getting Started"}]," — Set up the core Sentinel middleware"]}],["$","li",null,{"children":[["$","a",null,{"href":"/docs/the-dashboard","children":"Dashboard"}]," — Browse audit logs and other security data in the UI"]}],["$","li",null,{"children":[["$","a",null,{"href":"/docs/performance","children":"Performance"}]," — Monitor route-level performance alongside audit trails"]}],["$","li",null,{"children":[["$","a",null,{"href":"/docs/alerting","children":"Alerting"}]," — Get notified when threat events occur"]}],["$","li",null,{"children":[["$","a",null,{"href":"/docs/waf","children":"WAF"}]," — Protect your application from common web attacks"]}]]}]
3d:["$","script","script-0",{"src":"/_next/static/chunks/2425b678dfc0c3cf.js","async":true,"nonce":"$undefined"}]
3e:["$","$L44",null,{"children":["$","$45",null,{"name":"Next.MetadataOutlet","children":"$@46"}]}]
3f:["$","$1","h",{"children":[null,["$","$L47",null,{"children":"$L48"}],["$","div",null,{"hidden":true,"children":["$","$L49",null,{"children":["$","$45",null,{"name":"Next.Metadata","children":"$L4a"}]}]}],null]}]
8:"$0:f:0:1:1:children:0:props:children:1:props:serverProvidedParams:params"
48:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
46:null
4a:[["$","title","0",{"children":"Audit Logging - Sentinel Docs"}],["$","meta","1",{"name":"description","content":"Production-grade security middleware for Go/Gin applications. WAF, rate limiting, threat detection, AI analysis, and an embedded dashboard."}]]
